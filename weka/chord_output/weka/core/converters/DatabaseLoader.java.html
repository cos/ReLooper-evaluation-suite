<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<LINK REL=STYLESHEET TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">
<META NAME="GENERATOR" CONTENT="Java2HTML Version 1.5">
<TITLE>weka.core.converters.DatabaseLoader (Java2HTML)</TITLE>
</HEAD>
<BODY><TABLE id="Header" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2" width="33%">&nbsp;</td>
<td align="center" colspan="2" width="33%">
<font size="4">DatabaseLoader.java</font>
</td>
<td align="right" colspan="2" width="33%">&nbsp;</td>
</tr>
</TABLE>
<pre ID="Classes">
<FONT ID="LN">1   </FONT><A NAME="1"></A><FONT ID="MultiLineComment">/*
<FONT ID="LN">2   </FONT><A NAME="2"></A> *    This program is free software; you can redistribute it and/or modify
<FONT ID="LN">3   </FONT><A NAME="3"></A> *    it under the terms of the GNU General Public License as published by
<FONT ID="LN">4   </FONT><A NAME="4"></A> *    the Free Software Foundation; either version 2 of the License, or
<FONT ID="LN">5   </FONT><A NAME="5"></A> *    (at your option) any later version.
<FONT ID="LN">6   </FONT><A NAME="6"></A> *
<FONT ID="LN">7   </FONT><A NAME="7"></A> *    This program is distributed in the hope that it will be useful,
<FONT ID="LN">8   </FONT><A NAME="8"></A> *    but WITHOUT ANY WARRANTY; without even the implied warranty of
<FONT ID="LN">9   </FONT><A NAME="9"></A> *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<FONT ID="LN">10  </FONT><A NAME="10"></A> *    GNU General Public License for more details.
<FONT ID="LN">11  </FONT><A NAME="11"></A> *
<FONT ID="LN">12  </FONT><A NAME="12"></A> *    You should have received a copy of the GNU General Public License
<FONT ID="LN">13  </FONT><A NAME="13"></A> *    along with this program; if not, write to the Free Software
<FONT ID="LN">14  </FONT><A NAME="14"></A> *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
<FONT ID="LN">15  </FONT><A NAME="15"></A> */</FONT>
<FONT ID="LN">16  </FONT><A NAME="16"></A>
<FONT ID="LN">17  </FONT><A NAME="17"></A><FONT ID="MultiLineComment">/*
<FONT ID="LN">18  </FONT><A NAME="18"></A> *    DatabaseLoader.java
<FONT ID="LN">19  </FONT><A NAME="19"></A> *    Copyright (C) 2004 University of Waikato, Hamilton, New Zealand
<FONT ID="LN">20  </FONT><A NAME="20"></A> *
<FONT ID="LN">21  </FONT><A NAME="21"></A> */</FONT>
<FONT ID="LN">22  </FONT><A NAME="22"></A>
<FONT ID="LN">23  </FONT><A NAME="23"></A><FONT ID="Package">package</FONT> weka.core.converters;
<FONT ID="LN">24  </FONT><A NAME="24"></A>
<FONT ID="LN">25  </FONT><A NAME="25"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/Instance.java.html">weka.core.Instance</A>;
<FONT ID="LN">26  </FONT><A NAME="26"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/DenseInstance.java.html">weka.core.DenseInstance</A>;
<FONT ID="LN">27  </FONT><A NAME="27"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/Instances.java.html">weka.core.Instances</A>;
<FONT ID="LN">28  </FONT><A NAME="28"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/Attribute.java.html">weka.core.Attribute</A>;
<FONT ID="LN">29  </FONT><A NAME="29"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/OptionHandler.java.html">weka.core.OptionHandler</A>;
<FONT ID="LN">30  </FONT><A NAME="30"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/RevisionUtils.java.html">weka.core.RevisionUtils</A>;
<FONT ID="LN">31  </FONT><A NAME="31"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/Utils.java.html">weka.core.Utils</A>;
<FONT ID="LN">32  </FONT><A NAME="32"></A><FONT ID="Import">import</FONT> <A HREF="../../../weka/core/Option.java.html">weka.core.Option</A>;
<FONT ID="LN">33  </FONT><A NAME="33"></A><FONT ID="Import">import</FONT> java.io.IOException;
<FONT ID="LN">34  </FONT><A NAME="34"></A><FONT ID="Import">import</FONT> java.sql.*;
<FONT ID="LN">35  </FONT><A NAME="35"></A><FONT ID="Import">import</FONT> java.util.Hashtable;
<FONT ID="LN">36  </FONT><A NAME="36"></A><FONT ID="Import">import</FONT> java.util.Properties;
<FONT ID="LN">37  </FONT><A NAME="37"></A><FONT ID="Import">import</FONT> java.util.StringTokenizer;
<FONT ID="LN">38  </FONT><A NAME="38"></A><FONT ID="Import">import</FONT> java.util.Enumeration;
<FONT ID="LN">39  </FONT><A NAME="39"></A><FONT ID="Import">import</FONT> java.util.Vector;
<FONT ID="LN">40  </FONT><A NAME="40"></A><FONT ID="Import">import</FONT> java.util.ArrayList;
<FONT ID="LN">41  </FONT><A NAME="41"></A>
<FONT ID="LN">42  </FONT><A NAME="42"></A><FONT ID="FormalComment">/**
<FONT ID="LN">43  </FONT><A NAME="43"></A> &lt;!-- globalinfo-start --&gt;
<FONT ID="LN">44  </FONT><A NAME="44"></A> * Reads Instances from a Database. Can read a database in batch or incremental mode.&lt;br/&gt;
<FONT ID="LN">45  </FONT><A NAME="45"></A> * In inremental mode MySQL and HSQLDB are supported.&lt;br/&gt;
<FONT ID="LN">46  </FONT><A NAME="46"></A> * For all other DBMS set a pseudoincremental mode is used:&lt;br/&gt;
<FONT ID="LN">47  </FONT><A NAME="47"></A> * In pseudo incremental mode the instances are read into main memory all at once and then incrementally provided to the user.&lt;br/&gt;
<FONT ID="LN">48  </FONT><A NAME="48"></A> * For incremental loading the rows in the database table have to be ordered uniquely.&lt;br/&gt;
<FONT ID="LN">49  </FONT><A NAME="49"></A> * The reason for this is that every time only a single row is fetched by extending the user query by a LIMIT clause.&lt;br/&gt;
<FONT ID="LN">50  </FONT><A NAME="50"></A> * If this extension is impossible instances will be loaded pseudoincrementally. To ensure that every row is fetched exaclty once, they have to ordered.&lt;br/&gt;
<FONT ID="LN">51  </FONT><A NAME="51"></A> * Therefore a (primary) key is necessary.This approach is chosen, instead of using JDBC driver facilities, because the latter one differ betweeen different drivers.&lt;br/&gt;
<FONT ID="LN">52  </FONT><A NAME="52"></A> * If you use the DatabaseSaver and save instances by generating automatically a primary key (its name is defined in DtabaseUtils), this primary key will be used for ordering but will not be part of the output. The user defined SQL query to extract the instances should not contain LIMIT and ORDER BY clauses (see -Q option).&lt;br/&gt;
<FONT ID="LN">53  </FONT><A NAME="53"></A> * In addition, for incremental loading,  you can define in the DatabaseUtils file how many distinct values a nominal attribute is allowed to have. If this number is exceeded, the column will become a string attribute.&lt;br/&gt;
<FONT ID="LN">54  </FONT><A NAME="54"></A> * In batch mode no string attributes will be created.
<FONT ID="LN">55  </FONT><A NAME="55"></A> * &lt;p/&gt;
<FONT ID="LN">56  </FONT><A NAME="56"></A> &lt;!-- globalinfo-end --&gt;
<FONT ID="LN">57  </FONT><A NAME="57"></A> *
<FONT ID="LN">58  </FONT><A NAME="58"></A> &lt;!-- options-start --&gt;
<FONT ID="LN">59  </FONT><A NAME="59"></A> * Valid options are: &lt;p/&gt;
<FONT ID="LN">60  </FONT><A NAME="60"></A> * 
<FONT ID="LN">61  </FONT><A NAME="61"></A> * &lt;pre&gt; -url &amp;lt;JDBC URL&amp;gt;
<FONT ID="LN">62  </FONT><A NAME="62"></A> *  The JDBC URL to connect to.
<FONT ID="LN">63  </FONT><A NAME="63"></A> *  (default: from DatabaseUtils.props file)&lt;/pre&gt;
<FONT ID="LN">64  </FONT><A NAME="64"></A> * 
<FONT ID="LN">65  </FONT><A NAME="65"></A> * &lt;pre&gt; -user &amp;lt;name&amp;gt;
<FONT ID="LN">66  </FONT><A NAME="66"></A> *  The user to connect with to the database.
<FONT ID="LN">67  </FONT><A NAME="67"></A> *  (default: none)&lt;/pre&gt;
<FONT ID="LN">68  </FONT><A NAME="68"></A> * 
<FONT ID="LN">69  </FONT><A NAME="69"></A> * &lt;pre&gt; -password &amp;lt;password&amp;gt;
<FONT ID="LN">70  </FONT><A NAME="70"></A> *  The password to connect with to the database.
<FONT ID="LN">71  </FONT><A NAME="71"></A> *  (default: none)&lt;/pre&gt;
<FONT ID="LN">72  </FONT><A NAME="72"></A> * 
<FONT ID="LN">73  </FONT><A NAME="73"></A> * &lt;pre&gt; -Q &amp;lt;query&amp;gt;
<FONT ID="LN">74  </FONT><A NAME="74"></A> *  SQL query of the form
<FONT ID="LN">75  </FONT><A NAME="75"></A> *   SELECT &amp;lt;list of columns&amp;gt;|* FROM &amp;lt;table&amp;gt; [WHERE]
<FONT ID="LN">76  </FONT><A NAME="76"></A> *  to execute.
<FONT ID="LN">77  </FONT><A NAME="77"></A> *  (default: Select * From Results0)&lt;/pre&gt;
<FONT ID="LN">78  </FONT><A NAME="78"></A> * 
<FONT ID="LN">79  </FONT><A NAME="79"></A> * &lt;pre&gt; -P &amp;lt;list of column names&amp;gt;
<FONT ID="LN">80  </FONT><A NAME="80"></A> *  List of column names uniquely defining a DB row
<FONT ID="LN">81  </FONT><A NAME="81"></A> *  (separated by ', ').
<FONT ID="LN">82  </FONT><A NAME="82"></A> *  Used for incremental loading.
<FONT ID="LN">83  </FONT><A NAME="83"></A> *  If not specified, the key will be determined automatically,
<FONT ID="LN">84  </FONT><A NAME="84"></A> *  if possible with the used JDBC driver.
<FONT ID="LN">85  </FONT><A NAME="85"></A> *  The auto ID column created by the DatabaseSaver won't be loaded.&lt;/pre&gt;
<FONT ID="LN">86  </FONT><A NAME="86"></A> * 
<FONT ID="LN">87  </FONT><A NAME="87"></A> * &lt;pre&gt; -I
<FONT ID="LN">88  </FONT><A NAME="88"></A> *  Sets incremental loading&lt;/pre&gt;
<FONT ID="LN">89  </FONT><A NAME="89"></A> * 
<FONT ID="LN">90  </FONT><A NAME="90"></A> &lt;!-- options-end --&gt;
<FONT ID="LN">91  </FONT><A NAME="91"></A> *
<FONT ID="LN">92  </FONT><A NAME="92"></A> * @author Stefan Mutter (mutter@cs.waikato.ac.nz)
<FONT ID="LN">93  </FONT><A NAME="93"></A> * @version $Revision: 5987 $
<FONT ID="LN">94  </FONT><A NAME="94"></A> * @see Loader
<FONT ID="LN">95  </FONT><A NAME="95"></A> */</FONT>
<FONT ID="LN">96  </FONT><A NAME="96"></A><FONT ID="Public">public</FONT> <FONT ID="Class">class</FONT> DatabaseLoader 
<FONT ID="LN">97  </FONT><A NAME="97"></A>  <FONT ID="Extends">extends</FONT> <A HREF="../../../weka/core/converters/AbstractLoader.java.html">AbstractLoader</A> 
<FONT ID="LN">98  </FONT><A NAME="98"></A>  <FONT ID="Implements">implements</FONT> <A HREF="../../../weka/core/converters/BatchConverter.java.html">BatchConverter</A>, <A HREF="../../../weka/core/converters/IncrementalConverter.java.html">IncrementalConverter</A>, <A HREF="../../../weka/core/converters/DatabaseConverter.java.html">DatabaseConverter</A>, <A HREF="../../../weka/core/OptionHandler.java.html">OptionHandler</A> {
<FONT ID="LN">99  </FONT><A NAME="99"></A>
<FONT ID="LN">100 </FONT><A NAME="100"></A>  <FONT ID="FormalComment">/** for serialization */</FONT>
<FONT ID="LN">101 </FONT><A NAME="101"></A>  <FONT ID="Static">static</FONT> <FONT ID="Final">final</FONT> <FONT ID="Long">long</FONT> serialVersionUID = -<FONT ID="IntegerLiteral">7936159015338318659L</FONT>;
<FONT ID="LN">102 </FONT><A NAME="102"></A>  
<FONT ID="LN">103 </FONT><A NAME="103"></A>  <FONT ID="FormalComment">/** The header information that is retrieved in the beginning of incremental loading */</FONT>
<FONT ID="LN">104 </FONT><A NAME="104"></A>  <FONT ID="Protected">protected</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A> m_structure;
<FONT ID="LN">105 </FONT><A NAME="105"></A>  
<FONT ID="LN">106 </FONT><A NAME="106"></A>  <FONT ID="FormalComment">/** Used in pseudoincremental mode. The whole dataset from which instances will be read incrementally.*/</FONT>
<FONT ID="LN">107 </FONT><A NAME="107"></A>  <FONT ID="Private">private</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A> m_datasetPseudoInc;
<FONT ID="LN">108 </FONT><A NAME="108"></A>  
<FONT ID="LN">109 </FONT><A NAME="109"></A>  <FONT ID="FormalComment">/** Set of instances that equals m_structure except that the auto_generated_id column is not included as an attribute*/</FONT>
<FONT ID="LN">110 </FONT><A NAME="110"></A>  <FONT ID="Private">private</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A> m_oldStructure;
<FONT ID="LN">111 </FONT><A NAME="111"></A>  
<FONT ID="LN">112 </FONT><A NAME="112"></A>  <FONT ID="FormalComment">/** The database connection */</FONT>
<FONT ID="LN">113 </FONT><A NAME="113"></A>  <FONT ID="Private">private</FONT> <A HREF="../../../weka/core/converters/DatabaseConnection.java.html">DatabaseConnection</A> m_DataBaseConnection;
<FONT ID="LN">114 </FONT><A NAME="114"></A>  
<FONT ID="LN">115 </FONT><A NAME="115"></A>  <FONT ID="FormalComment">/** The user defined query to load instances. (form: SELECT *|&amp;ltcolumn-list&amp;gt; FROM &amp;lttable&amp;gt; [WHERE &amp;lt;condition&amp;gt;]) */</FONT>
<FONT ID="LN">116 </FONT><A NAME="116"></A>  <FONT ID="Private">private</FONT> String m_query = <FONT ID="StringLiteral">"Select * from Results0"</FONT>;
<FONT ID="LN">117 </FONT><A NAME="117"></A>  
<FONT ID="LN">118 </FONT><A NAME="118"></A>  <FONT ID="FormalComment">/** Flag indicating that pseudo incremental mode is used (all instances load at once into main memeory and then incrementally from main memory instead of the database) */</FONT>
<FONT ID="LN">119 </FONT><A NAME="119"></A>  <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> m_pseudoIncremental;
<FONT ID="LN">120 </FONT><A NAME="120"></A>  
<FONT ID="LN">121 </FONT><A NAME="121"></A>  <FONT ID="FormalComment">/** If true it checks whether or not the table exists in the database before loading depending on jdbc metadata information.
<FONT ID="LN">122 </FONT><A NAME="122"></A>   *  Set flag to false if no check is required or if jdbc metadata is not complete. */</FONT>
<FONT ID="LN">123 </FONT><A NAME="123"></A>  <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> m_checkForTable;
<FONT ID="LN">124 </FONT><A NAME="124"></A>  
<FONT ID="LN">125 </FONT><A NAME="125"></A>  <FONT ID="FormalComment">/** Limit when an attribute is treated as string attribute and not as a nominal one because it has to many values. */</FONT>
<FONT ID="LN">126 </FONT><A NAME="126"></A>  <FONT ID="Private">private</FONT> <FONT ID="Int">int</FONT> m_nominalToStringLimit;
<FONT ID="LN">127 </FONT><A NAME="127"></A>  
<FONT ID="LN">128 </FONT><A NAME="128"></A>  <FONT ID="FormalComment">/** The number of rows obtained by m_query, eg the size of the ResultSet to load*/</FONT>
<FONT ID="LN">129 </FONT><A NAME="129"></A>  <FONT ID="Private">private</FONT> <FONT ID="Int">int</FONT> m_rowCount;
<FONT ID="LN">130 </FONT><A NAME="130"></A>  
<FONT ID="LN">131 </FONT><A NAME="131"></A>  <FONT ID="FormalComment">/** Indicates how many rows has already been loaded incrementally */</FONT>
<FONT ID="LN">132 </FONT><A NAME="132"></A>  <FONT ID="Private">private</FONT> <FONT ID="Int">int</FONT> m_counter;
<FONT ID="LN">133 </FONT><A NAME="133"></A>  
<FONT ID="LN">134 </FONT><A NAME="134"></A>  <FONT ID="FormalComment">/** Decides which SQL statement to limit the number of rows should be used. DBMS dependent. Algorithm just tries several possibilities. */</FONT>
<FONT ID="LN">135 </FONT><A NAME="135"></A>  <FONT ID="Private">private</FONT> <FONT ID="Int">int</FONT> m_choice;
<FONT ID="LN">136 </FONT><A NAME="136"></A>  
<FONT ID="LN">137 </FONT><A NAME="137"></A>  <FONT ID="FormalComment">/** Flag indicating that incremental process wants to read first instance*/</FONT>
<FONT ID="LN">138 </FONT><A NAME="138"></A>  <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> m_firstTime;
<FONT ID="LN">139 </FONT><A NAME="139"></A>  
<FONT ID="LN">140 </FONT><A NAME="140"></A>  <FONT ID="FormalComment">/** Flag indicating that incremental mode is chosen (for command line use only)*/</FONT>
<FONT ID="LN">141 </FONT><A NAME="141"></A>  <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> m_inc;
<FONT ID="LN">142 </FONT><A NAME="142"></A>  
<FONT ID="LN">143 </FONT><A NAME="143"></A>  <FONT ID="FormalComment">/** Contains the name of the columns that uniquely define a row in the ResultSet. Ensures a unique ordering of instances for indremental loading.*/</FONT>
<FONT ID="LN">144 </FONT><A NAME="144"></A>  <FONT ID="Private">private</FONT> ArrayList&lt;String&gt; m_orderBy;
<FONT ID="LN">145 </FONT><A NAME="145"></A>  
<FONT ID="LN">146 </FONT><A NAME="146"></A>  <FONT ID="FormalComment">/** Stores the index of a nominal value */</FONT>
<FONT ID="LN">147 </FONT><A NAME="147"></A>  <FONT ID="Private">private</FONT> Hashtable&lt;String,Double&gt; [] m_nominalIndexes;
<FONT ID="LN">148 </FONT><A NAME="148"></A>  
<FONT ID="LN">149 </FONT><A NAME="149"></A>  <FONT ID="FormalComment">/**  Stores the nominal value*/</FONT>
<FONT ID="LN">150 </FONT><A NAME="150"></A>  <FONT ID="Private">private</FONT> ArrayList&lt;String&gt; [] m_nominalStrings;
<FONT ID="LN">151 </FONT><A NAME="151"></A>  
<FONT ID="LN">152 </FONT><A NAME="152"></A>  <FONT ID="FormalComment">/** Name of the primary key column that will allow unique ordering necessary for incremental loading. The name is specified in the DatabaseUtils file.*/</FONT>
<FONT ID="LN">153 </FONT><A NAME="153"></A>  <FONT ID="Private">private</FONT> String m_idColumn;
<FONT ID="LN">154 </FONT><A NAME="154"></A>  
<FONT ID="LN">155 </FONT><A NAME="155"></A>  <FONT ID="FormalComment">/** The property file for the database connection */</FONT>
<FONT ID="LN">156 </FONT><A NAME="156"></A>  <FONT ID="Protected">protected</FONT> <FONT ID="Static">static</FONT> String PROPERTY_FILE = DatabaseConnection.PROPERTY_FILE;
<FONT ID="LN">157 </FONT><A NAME="157"></A>  
<FONT ID="LN">158 </FONT><A NAME="158"></A>  <FONT ID="FormalComment">/** Properties associated with the database connection */</FONT>
<FONT ID="LN">159 </FONT><A NAME="159"></A>  <FONT ID="Protected">protected</FONT> <FONT ID="Static">static</FONT> Properties PROPERTIES;
<FONT ID="LN">160 </FONT><A NAME="160"></A>
<FONT ID="LN">161 </FONT><A NAME="161"></A>  <FONT ID="FormalComment">/** the JDBC URL to use */</FONT>
<FONT ID="LN">162 </FONT><A NAME="162"></A>  <FONT ID="Protected">protected</FONT> String m_URL = <FONT ID="Null">null</FONT>;
<FONT ID="LN">163 </FONT><A NAME="163"></A>
<FONT ID="LN">164 </FONT><A NAME="164"></A>  <FONT ID="FormalComment">/** the database user to use */</FONT>
<FONT ID="LN">165 </FONT><A NAME="165"></A>  <FONT ID="Protected">protected</FONT> String m_User = <FONT ID="Null">null</FONT>;
<FONT ID="LN">166 </FONT><A NAME="166"></A>
<FONT ID="LN">167 </FONT><A NAME="167"></A>  <FONT ID="FormalComment">/** the database password to use */</FONT>
<FONT ID="LN">168 </FONT><A NAME="168"></A>  <FONT ID="Protected">protected</FONT> String m_Password = <FONT ID="Null">null</FONT>;
<FONT ID="LN">169 </FONT><A NAME="169"></A>  
<FONT ID="LN">170 </FONT><A NAME="170"></A>  <FONT ID="FormalComment">/** the keys for unique ordering */</FONT>
<FONT ID="LN">171 </FONT><A NAME="171"></A>  <FONT ID="Protected">protected</FONT> String m_Keys = <FONT ID="Null">null</FONT>;
<FONT ID="LN">172 </FONT><A NAME="172"></A>  
<FONT ID="LN">173 </FONT><A NAME="173"></A>  <FONT ID="FormalComment">/** reads the property file */</FONT>
<FONT ID="LN">174 </FONT><A NAME="174"></A>  <FONT ID="Static">static</FONT> {
<FONT ID="LN">175 </FONT><A NAME="175"></A>
<FONT ID="LN">176 </FONT><A NAME="176"></A>    <FONT ID="Try">try</FONT> {
<FONT ID="LN">177 </FONT><A NAME="177"></A>      PROPERTIES = Utils.readProperties(PROPERTY_FILE);
<FONT ID="LN">178 </FONT><A NAME="178"></A>   
<FONT ID="LN">179 </FONT><A NAME="179"></A>    } <FONT ID="Catch">catch</FONT> (Exception ex) {
<FONT ID="LN">180 </FONT><A NAME="180"></A>      System.err.println(<FONT ID="StringLiteral">"Problem reading properties. Fix before continuing."</FONT>);
<FONT ID="LN">181 </FONT><A NAME="181"></A>      System.err.println(ex);
<FONT ID="LN">182 </FONT><A NAME="182"></A>    }
<FONT ID="LN">183 </FONT><A NAME="183"></A>  }
<FONT ID="LN">184 </FONT><A NAME="184"></A>  
<FONT ID="LN">185 </FONT><A NAME="185"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">186 </FONT><A NAME="186"></A>   * Constructor
<FONT ID="LN">187 </FONT><A NAME="187"></A>   * 
<FONT ID="LN">188 </FONT><A NAME="188"></A>   * @throws Exception if initialization fails
<FONT ID="LN">189 </FONT><A NAME="189"></A>   */</FONT>
<FONT ID="LN">190 </FONT><A NAME="190"></A>  <FONT ID="Public">public</FONT> DatabaseLoader() <FONT ID="Throws">throws</FONT> Exception{
<FONT ID="LN">191 </FONT><A NAME="191"></A>  
<FONT ID="LN">192 </FONT><A NAME="192"></A>      reset();
<FONT ID="LN">193 </FONT><A NAME="193"></A>      m_pseudoIncremental=<FONT ID="False">false</FONT>;
<FONT ID="LN">194 </FONT><A NAME="194"></A>      m_checkForTable=<FONT ID="True">true</FONT>;
<FONT ID="LN">195 </FONT><A NAME="195"></A>      String props=PROPERTIES.getProperty(<FONT ID="StringLiteral">"nominalToStringLimit"</FONT>);
<FONT ID="LN">196 </FONT><A NAME="196"></A>      m_nominalToStringLimit = Integer.parseInt(props);
<FONT ID="LN">197 </FONT><A NAME="197"></A>      m_idColumn=PROPERTIES.getProperty(<FONT ID="StringLiteral">"idColumn"</FONT>);
<FONT ID="LN">198 </FONT><A NAME="198"></A>      <FONT ID="If">if</FONT> (PROPERTIES.getProperty(<FONT ID="StringLiteral">"checkForTable"</FONT>, <FONT ID="StringLiteral">""</FONT>).equalsIgnoreCase(<FONT ID="StringLiteral">"FALSE"</FONT>))
<FONT ID="LN">199 </FONT><A NAME="199"></A>    m_checkForTable=<FONT ID="False">false</FONT>;
<FONT ID="LN">200 </FONT><A NAME="200"></A>  }
<FONT ID="LN">201 </FONT><A NAME="201"></A>
<FONT ID="LN">202 </FONT><A NAME="202"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">203 </FONT><A NAME="203"></A>   * Returns a string describing this Loader
<FONT ID="LN">204 </FONT><A NAME="204"></A>   * 
<FONT ID="LN">205 </FONT><A NAME="205"></A>   * @return a description of the Loader suitable for
<FONT ID="LN">206 </FONT><A NAME="206"></A>   * displaying in the explorer/experimenter gui
<FONT ID="LN">207 </FONT><A NAME="207"></A>   */</FONT>
<FONT ID="LN">208 </FONT><A NAME="208"></A>  <FONT ID="Public">public</FONT> String globalInfo() {
<FONT ID="LN">209 </FONT><A NAME="209"></A>    <FONT ID="Return">return</FONT> 
<FONT ID="LN">210 </FONT><A NAME="210"></A>        <FONT ID="StringLiteral">"Reads Instances from a Database. "</FONT>
<FONT ID="LN">211 </FONT><A NAME="211"></A>      + <FONT ID="StringLiteral">"Can read a database in batch or incremental mode.\n"</FONT>
<FONT ID="LN">212 </FONT><A NAME="212"></A>      + <FONT ID="StringLiteral">"In inremental mode MySQL and HSQLDB are supported.\n"</FONT>
<FONT ID="LN">213 </FONT><A NAME="213"></A>      + <FONT ID="StringLiteral">"For all other DBMS set a pseudoincremental mode is used:\n"</FONT>
<FONT ID="LN">214 </FONT><A NAME="214"></A>      + <FONT ID="StringLiteral">"In pseudo incremental mode the instances are read into main memory all at once and then incrementally provided to the user.\n"</FONT>
<FONT ID="LN">215 </FONT><A NAME="215"></A>      + <FONT ID="StringLiteral">"For incremental loading the rows in the database table have to be ordered uniquely.\n"</FONT>
<FONT ID="LN">216 </FONT><A NAME="216"></A>      + <FONT ID="StringLiteral">"The reason for this is that every time only a single row is fetched by extending the user query by a LIMIT clause.\n"</FONT>
<FONT ID="LN">217 </FONT><A NAME="217"></A>      + <FONT ID="StringLiteral">"If this extension is impossible instances will be loaded pseudoincrementally. To ensure that every row is fetched exaclty once, they have to ordered.\n"</FONT>
<FONT ID="LN">218 </FONT><A NAME="218"></A>      + <FONT ID="StringLiteral">"Therefore a (primary) key is necessary.This approach is chosen, instead of using JDBC driver facilities, because the latter one differ betweeen different drivers.\n"</FONT>
<FONT ID="LN">219 </FONT><A NAME="219"></A>      + <FONT ID="StringLiteral">"If you use the DatabaseSaver and save instances by generating automatically a primary key (its name is defined in DtabaseUtils), this primary key will "</FONT>
<FONT ID="LN">220 </FONT><A NAME="220"></A>      + <FONT ID="StringLiteral">"be used for ordering but will not be part of the output. The user defined SQL query to extract the instances should not contain LIMIT and ORDER BY clauses (see -Q option).\n"</FONT>
<FONT ID="LN">221 </FONT><A NAME="221"></A>      + <FONT ID="StringLiteral">"In addition, for incremental loading,  you can define in the DatabaseUtils file how many distinct values a nominal attribute is allowed to have. If this number is exceeded, the column will become a string attribute.\n"</FONT>
<FONT ID="LN">222 </FONT><A NAME="222"></A>      + <FONT ID="StringLiteral">"In batch mode no string attributes will be created."</FONT>;
<FONT ID="LN">223 </FONT><A NAME="223"></A>  }
<FONT ID="LN">224 </FONT><A NAME="224"></A>
<FONT ID="LN">225 </FONT><A NAME="225"></A>  
<FONT ID="LN">226 </FONT><A NAME="226"></A>
<FONT ID="LN">227 </FONT><A NAME="227"></A>  <FONT ID="FormalComment">/** Resets the Loader ready to read a new data set
<FONT ID="LN">228 </FONT><A NAME="228"></A>   * @throws Exception if an error occurs while disconnecting from the database
<FONT ID="LN">229 </FONT><A NAME="229"></A>   */</FONT>
<FONT ID="LN">230 </FONT><A NAME="230"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> reset() <FONT ID="Throws">throws</FONT> Exception{
<FONT ID="LN">231 </FONT><A NAME="231"></A>
<FONT ID="LN">232 </FONT><A NAME="232"></A>    resetStructure();
<FONT ID="LN">233 </FONT><A NAME="233"></A>    <FONT ID="If">if</FONT>(m_DataBaseConnection != <FONT ID="Null">null</FONT> &amp;&amp; m_DataBaseConnection.isConnected())
<FONT ID="LN">234 </FONT><A NAME="234"></A>        m_DataBaseConnection.disconnectFromDatabase();
<FONT ID="LN">235 </FONT><A NAME="235"></A>    m_DataBaseConnection = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/converters/DatabaseConnection.java.html">DatabaseConnection</A>();
<FONT ID="LN">236 </FONT><A NAME="236"></A>
<FONT ID="LN">237 </FONT><A NAME="237"></A>    <FONT ID="SingleLineComment">// don't lose previously set connection data!
<FONT ID="LN">238 </FONT><A NAME="238"></A></FONT>    <FONT ID="If">if</FONT> (m_URL != <FONT ID="Null">null</FONT>)
<FONT ID="LN">239 </FONT><A NAME="239"></A>      m_DataBaseConnection.setDatabaseURL(m_URL);
<FONT ID="LN">240 </FONT><A NAME="240"></A>    <FONT ID="If">if</FONT> (m_User != <FONT ID="Null">null</FONT>)
<FONT ID="LN">241 </FONT><A NAME="241"></A>      m_DataBaseConnection.setUsername(m_User);
<FONT ID="LN">242 </FONT><A NAME="242"></A>    <FONT ID="If">if</FONT> (m_Password != <FONT ID="Null">null</FONT>)
<FONT ID="LN">243 </FONT><A NAME="243"></A>      m_DataBaseConnection.setPassword(m_Password);
<FONT ID="LN">244 </FONT><A NAME="244"></A>
<FONT ID="LN">245 </FONT><A NAME="245"></A>    m_orderBy = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">246 </FONT><A NAME="246"></A>    <FONT ID="SingleLineComment">// don't lose previously set key columns!
<FONT ID="LN">247 </FONT><A NAME="247"></A></FONT>    <FONT ID="If">if</FONT> (m_Keys != <FONT ID="Null">null</FONT>)
<FONT ID="LN">248 </FONT><A NAME="248"></A>      setKeys(m_Keys);
<FONT ID="LN">249 </FONT><A NAME="249"></A>      
<FONT ID="LN">250 </FONT><A NAME="250"></A>    m_inc = <FONT ID="False">false</FONT>;
<FONT ID="LN">251 </FONT><A NAME="251"></A>    
<FONT ID="LN">252 </FONT><A NAME="252"></A>  }
<FONT ID="LN">253 </FONT><A NAME="253"></A>  
<FONT ID="LN">254 </FONT><A NAME="254"></A>  
<FONT ID="LN">255 </FONT><A NAME="255"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">256 </FONT><A NAME="256"></A>   * Resets the structure of instances
<FONT ID="LN">257 </FONT><A NAME="257"></A>   */</FONT>
<FONT ID="LN">258 </FONT><A NAME="258"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> resetStructure(){
<FONT ID="LN">259 </FONT><A NAME="259"></A>  
<FONT ID="LN">260 </FONT><A NAME="260"></A>      m_structure = <FONT ID="Null">null</FONT>;
<FONT ID="LN">261 </FONT><A NAME="261"></A>      m_datasetPseudoInc = <FONT ID="Null">null</FONT>;
<FONT ID="LN">262 </FONT><A NAME="262"></A>      m_oldStructure = <FONT ID="Null">null</FONT>;
<FONT ID="LN">263 </FONT><A NAME="263"></A>      m_rowCount = <FONT ID="IntegerLiteral">0</FONT>;
<FONT ID="LN">264 </FONT><A NAME="264"></A>      m_counter = <FONT ID="IntegerLiteral">0</FONT>;
<FONT ID="LN">265 </FONT><A NAME="265"></A>      m_choice = <FONT ID="IntegerLiteral">0</FONT>;
<FONT ID="LN">266 </FONT><A NAME="266"></A>      m_firstTime = <FONT ID="True">true</FONT>;
<FONT ID="LN">267 </FONT><A NAME="267"></A>      setRetrieval(NONE);
<FONT ID="LN">268 </FONT><A NAME="268"></A>  }
<FONT ID="LN">269 </FONT><A NAME="269"></A>  
<FONT ID="LN">270 </FONT><A NAME="270"></A>  
<FONT ID="LN">271 </FONT><A NAME="271"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">272 </FONT><A NAME="272"></A>   * Sets the query to execute against the database
<FONT ID="LN">273 </FONT><A NAME="273"></A>   * 
<FONT ID="LN">274 </FONT><A NAME="274"></A>   * @param q the query to execute
<FONT ID="LN">275 </FONT><A NAME="275"></A>   */</FONT>
<FONT ID="LN">276 </FONT><A NAME="276"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setQuery(String q) {
<FONT ID="LN">277 </FONT><A NAME="277"></A>    q = q.replaceAll(<FONT ID="StringLiteral">"[fF][rR][oO][mM]"</FONT>,<FONT ID="StringLiteral">"FROM"</FONT>);
<FONT ID="LN">278 </FONT><A NAME="278"></A>    q = q.replaceFirst(<FONT ID="StringLiteral">"[sS][eE][lL][eE][cC][tT]"</FONT>,<FONT ID="StringLiteral">"SELECT"</FONT>);  
<FONT ID="LN">279 </FONT><A NAME="279"></A>    m_query = q;
<FONT ID="LN">280 </FONT><A NAME="280"></A>  }
<FONT ID="LN">281 </FONT><A NAME="281"></A>
<FONT ID="LN">282 </FONT><A NAME="282"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">283 </FONT><A NAME="283"></A>   * Gets the query to execute against the database
<FONT ID="LN">284 </FONT><A NAME="284"></A>   * 
<FONT ID="LN">285 </FONT><A NAME="285"></A>   * @return the query
<FONT ID="LN">286 </FONT><A NAME="286"></A>   */</FONT>
<FONT ID="LN">287 </FONT><A NAME="287"></A>  <FONT ID="Public">public</FONT> String getQuery() {
<FONT ID="LN">288 </FONT><A NAME="288"></A>    <FONT ID="Return">return</FONT> m_query;
<FONT ID="LN">289 </FONT><A NAME="289"></A>  }
<FONT ID="LN">290 </FONT><A NAME="290"></A>  
<FONT ID="LN">291 </FONT><A NAME="291"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">292 </FONT><A NAME="292"></A>   * the tip text for this property
<FONT ID="LN">293 </FONT><A NAME="293"></A>   * 
<FONT ID="LN">294 </FONT><A NAME="294"></A>   * @return the tip text
<FONT ID="LN">295 </FONT><A NAME="295"></A>   */</FONT>
<FONT ID="LN">296 </FONT><A NAME="296"></A>  <FONT ID="Public">public</FONT> String queryTipText(){
<FONT ID="LN">297 </FONT><A NAME="297"></A>  
<FONT ID="LN">298 </FONT><A NAME="298"></A>      <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"The query that should load the instances."</FONT>
<FONT ID="LN">299 </FONT><A NAME="299"></A>        +<FONT ID="StringLiteral">"\n The query has to be of the form SELECT &lt;column-list&gt;|* FROM &lt;table&gt; [WHERE &lt;conditions&gt;]"</FONT>;
<FONT ID="LN">300 </FONT><A NAME="300"></A>  }
<FONT ID="LN">301 </FONT><A NAME="301"></A>  
<FONT ID="LN">302 </FONT><A NAME="302"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">303 </FONT><A NAME="303"></A>   * Sets the key columns of a database table
<FONT ID="LN">304 </FONT><A NAME="304"></A>   * 
<FONT ID="LN">305 </FONT><A NAME="305"></A>   * @param keys a String containing the key columns in a comma separated list.
<FONT ID="LN">306 </FONT><A NAME="306"></A>   */</FONT>
<FONT ID="LN">307 </FONT><A NAME="307"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setKeys(String keys){
<FONT ID="LN">308 </FONT><A NAME="308"></A>  
<FONT ID="LN">309 </FONT><A NAME="309"></A>    m_Keys = keys;
<FONT ID="LN">310 </FONT><A NAME="310"></A>    m_orderBy.clear();
<FONT ID="LN">311 </FONT><A NAME="311"></A>    StringTokenizer st = <FONT ID="New">new</FONT> StringTokenizer(keys, <FONT ID="StringLiteral">","</FONT>);
<FONT ID="LN">312 </FONT><A NAME="312"></A>    <FONT ID="While">while</FONT> (st.hasMoreTokens()) {
<FONT ID="LN">313 </FONT><A NAME="313"></A>        String column = st.nextToken();
<FONT ID="LN">314 </FONT><A NAME="314"></A>        column = column.replaceAll(<FONT ID="StringLiteral">" "</FONT>,<FONT ID="StringLiteral">""</FONT>);
<FONT ID="LN">315 </FONT><A NAME="315"></A>        m_orderBy.add(column);
<FONT ID="LN">316 </FONT><A NAME="316"></A>    }
<FONT ID="LN">317 </FONT><A NAME="317"></A>  }
<FONT ID="LN">318 </FONT><A NAME="318"></A>  
<FONT ID="LN">319 </FONT><A NAME="319"></A>   <FONT ID="FormalComment">/**
<FONT ID="LN">320 </FONT><A NAME="320"></A>   * Gets the key columns' name
<FONT ID="LN">321 </FONT><A NAME="321"></A>   * 
<FONT ID="LN">322 </FONT><A NAME="322"></A>   * @return name of the key columns'
<FONT ID="LN">323 </FONT><A NAME="323"></A>   */</FONT>
<FONT ID="LN">324 </FONT><A NAME="324"></A>  <FONT ID="Public">public</FONT> String getKeys(){
<FONT ID="LN">325 </FONT><A NAME="325"></A>  
<FONT ID="LN">326 </FONT><A NAME="326"></A>      StringBuffer key = <FONT ID="New">new</FONT> StringBuffer();
<FONT ID="LN">327 </FONT><A NAME="327"></A>      <FONT ID="For">for</FONT>(<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>;i &lt; m_orderBy.size(); i++){
<FONT ID="LN">328 </FONT><A NAME="328"></A>        key.append((String)m_orderBy.get(i));
<FONT ID="LN">329 </FONT><A NAME="329"></A>        <FONT ID="If">if</FONT>(i != m_orderBy.size()-<FONT ID="IntegerLiteral">1</FONT>)
<FONT ID="LN">330 </FONT><A NAME="330"></A>          key.append(<FONT ID="StringLiteral">", "</FONT>);
<FONT ID="LN">331 </FONT><A NAME="331"></A>      }
<FONT ID="LN">332 </FONT><A NAME="332"></A>      <FONT ID="Return">return</FONT> key.toString();
<FONT ID="LN">333 </FONT><A NAME="333"></A>  }
<FONT ID="LN">334 </FONT><A NAME="334"></A>  
<FONT ID="LN">335 </FONT><A NAME="335"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">336 </FONT><A NAME="336"></A>   * the tip text for this property
<FONT ID="LN">337 </FONT><A NAME="337"></A>   * 
<FONT ID="LN">338 </FONT><A NAME="338"></A>   * @return the tip text
<FONT ID="LN">339 </FONT><A NAME="339"></A>   */</FONT>
<FONT ID="LN">340 </FONT><A NAME="340"></A>  <FONT ID="Public">public</FONT> String keysTipText(){
<FONT ID="LN">341 </FONT><A NAME="341"></A>  
<FONT ID="LN">342 </FONT><A NAME="342"></A>      <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"For incremental loading a unique identiefer has to be specified."</FONT>
<FONT ID="LN">343 </FONT><A NAME="343"></A>        +<FONT ID="StringLiteral">"\nIf the query includes all columns of a table (SELECT *...) a primary key"</FONT>
<FONT ID="LN">344 </FONT><A NAME="344"></A>        +<FONT ID="StringLiteral">"\ncan be detected automatically depending on the JDBC driver. If that is not possible"</FONT>
<FONT ID="LN">345 </FONT><A NAME="345"></A>        +<FONT ID="StringLiteral">"\nspecify the key columns here in a comma separated list."</FONT>;
<FONT ID="LN">346 </FONT><A NAME="346"></A>  }
<FONT ID="LN">347 </FONT><A NAME="347"></A>  
<FONT ID="LN">348 </FONT><A NAME="348"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">349 </FONT><A NAME="349"></A>   * Sets the database URL
<FONT ID="LN">350 </FONT><A NAME="350"></A>   * 
<FONT ID="LN">351 </FONT><A NAME="351"></A>   * @param url string with the database URL
<FONT ID="LN">352 </FONT><A NAME="352"></A>   */</FONT>
<FONT ID="LN">353 </FONT><A NAME="353"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setUrl(String url){
<FONT ID="LN">354 </FONT><A NAME="354"></A>      
<FONT ID="LN">355 </FONT><A NAME="355"></A>      m_URL = url;
<FONT ID="LN">356 </FONT><A NAME="356"></A>      m_DataBaseConnection.setDatabaseURL(url);
<FONT ID="LN">357 </FONT><A NAME="357"></A>    
<FONT ID="LN">358 </FONT><A NAME="358"></A>  }
<FONT ID="LN">359 </FONT><A NAME="359"></A>  
<FONT ID="LN">360 </FONT><A NAME="360"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">361 </FONT><A NAME="361"></A>   * Gets the URL
<FONT ID="LN">362 </FONT><A NAME="362"></A>   * 
<FONT ID="LN">363 </FONT><A NAME="363"></A>   * @return the URL
<FONT ID="LN">364 </FONT><A NAME="364"></A>   */</FONT>
<FONT ID="LN">365 </FONT><A NAME="365"></A>  <FONT ID="Public">public</FONT> String getUrl(){
<FONT ID="LN">366 </FONT><A NAME="366"></A>  
<FONT ID="LN">367 </FONT><A NAME="367"></A>      <FONT ID="Return">return</FONT> m_DataBaseConnection.getDatabaseURL();
<FONT ID="LN">368 </FONT><A NAME="368"></A>  }
<FONT ID="LN">369 </FONT><A NAME="369"></A>  
<FONT ID="LN">370 </FONT><A NAME="370"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">371 </FONT><A NAME="371"></A>   * the tip text for this property
<FONT ID="LN">372 </FONT><A NAME="372"></A>   * 
<FONT ID="LN">373 </FONT><A NAME="373"></A>   * @return the tip text
<FONT ID="LN">374 </FONT><A NAME="374"></A>   */</FONT>
<FONT ID="LN">375 </FONT><A NAME="375"></A>  <FONT ID="Public">public</FONT> String urlTipText(){
<FONT ID="LN">376 </FONT><A NAME="376"></A>  
<FONT ID="LN">377 </FONT><A NAME="377"></A>      <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"The URL of the database"</FONT>;
<FONT ID="LN">378 </FONT><A NAME="378"></A>  }
<FONT ID="LN">379 </FONT><A NAME="379"></A>  
<FONT ID="LN">380 </FONT><A NAME="380"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">381 </FONT><A NAME="381"></A>   * Sets the database user
<FONT ID="LN">382 </FONT><A NAME="382"></A>   * 
<FONT ID="LN">383 </FONT><A NAME="383"></A>   * @param user the database user name
<FONT ID="LN">384 </FONT><A NAME="384"></A>   */</FONT>
<FONT ID="LN">385 </FONT><A NAME="385"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setUser(String user){
<FONT ID="LN">386 </FONT><A NAME="386"></A>   
<FONT ID="LN">387 </FONT><A NAME="387"></A>      m_User = user;
<FONT ID="LN">388 </FONT><A NAME="388"></A>      m_DataBaseConnection.setUsername(user);
<FONT ID="LN">389 </FONT><A NAME="389"></A>  }
<FONT ID="LN">390 </FONT><A NAME="390"></A>  
<FONT ID="LN">391 </FONT><A NAME="391"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">392 </FONT><A NAME="392"></A>   * Gets the user name
<FONT ID="LN">393 </FONT><A NAME="393"></A>   * 
<FONT ID="LN">394 </FONT><A NAME="394"></A>   * @return name of database user
<FONT ID="LN">395 </FONT><A NAME="395"></A>   */</FONT>
<FONT ID="LN">396 </FONT><A NAME="396"></A>  <FONT ID="Public">public</FONT> String getUser(){
<FONT ID="LN">397 </FONT><A NAME="397"></A>   
<FONT ID="LN">398 </FONT><A NAME="398"></A>      <FONT ID="Return">return</FONT> m_DataBaseConnection.getUsername();
<FONT ID="LN">399 </FONT><A NAME="399"></A>  }
<FONT ID="LN">400 </FONT><A NAME="400"></A>  
<FONT ID="LN">401 </FONT><A NAME="401"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">402 </FONT><A NAME="402"></A>   * the tip text for this property
<FONT ID="LN">403 </FONT><A NAME="403"></A>   * 
<FONT ID="LN">404 </FONT><A NAME="404"></A>   * @return the tip text
<FONT ID="LN">405 </FONT><A NAME="405"></A>   */</FONT>
<FONT ID="LN">406 </FONT><A NAME="406"></A>  <FONT ID="Public">public</FONT> String userTipText(){
<FONT ID="LN">407 </FONT><A NAME="407"></A>  
<FONT ID="LN">408 </FONT><A NAME="408"></A>      <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"The user name for the database"</FONT>;
<FONT ID="LN">409 </FONT><A NAME="409"></A>  }
<FONT ID="LN">410 </FONT><A NAME="410"></A>  
<FONT ID="LN">411 </FONT><A NAME="411"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">412 </FONT><A NAME="412"></A>   * Sets user password for the database
<FONT ID="LN">413 </FONT><A NAME="413"></A>   * 
<FONT ID="LN">414 </FONT><A NAME="414"></A>   * @param password the password
<FONT ID="LN">415 </FONT><A NAME="415"></A>   */</FONT>
<FONT ID="LN">416 </FONT><A NAME="416"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setPassword(String password){
<FONT ID="LN">417 </FONT><A NAME="417"></A>   
<FONT ID="LN">418 </FONT><A NAME="418"></A>      m_Password = password;
<FONT ID="LN">419 </FONT><A NAME="419"></A>      m_DataBaseConnection.setPassword(password);
<FONT ID="LN">420 </FONT><A NAME="420"></A>  }
<FONT ID="LN">421 </FONT><A NAME="421"></A>
<FONT ID="LN">422 </FONT><A NAME="422"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">423 </FONT><A NAME="423"></A>   * Returns the database password
<FONT ID="LN">424 </FONT><A NAME="424"></A>   *
<FONT ID="LN">425 </FONT><A NAME="425"></A>   * @return the database password
<FONT ID="LN">426 </FONT><A NAME="426"></A>   */</FONT>
<FONT ID="LN">427 </FONT><A NAME="427"></A>  <FONT ID="Public">public</FONT> String getPassword() {
<FONT ID="LN">428 </FONT><A NAME="428"></A>    <FONT ID="Return">return</FONT> m_DataBaseConnection.getPassword();
<FONT ID="LN">429 </FONT><A NAME="429"></A>  }
<FONT ID="LN">430 </FONT><A NAME="430"></A>  
<FONT ID="LN">431 </FONT><A NAME="431"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">432 </FONT><A NAME="432"></A>   * the tip text for this property
<FONT ID="LN">433 </FONT><A NAME="433"></A>   * 
<FONT ID="LN">434 </FONT><A NAME="434"></A>   * @return the tip text
<FONT ID="LN">435 </FONT><A NAME="435"></A>   */</FONT>
<FONT ID="LN">436 </FONT><A NAME="436"></A>  <FONT ID="Public">public</FONT> String passwordTipText(){
<FONT ID="LN">437 </FONT><A NAME="437"></A>  
<FONT ID="LN">438 </FONT><A NAME="438"></A>      <FONT ID="Return">return</FONT> <FONT ID="StringLiteral">"The database password"</FONT>;
<FONT ID="LN">439 </FONT><A NAME="439"></A>  }
<FONT ID="LN">440 </FONT><A NAME="440"></A>  
<FONT ID="LN">441 </FONT><A NAME="441"></A>  
<FONT ID="LN">442 </FONT><A NAME="442"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">443 </FONT><A NAME="443"></A>   * Sets the database url, user and pw
<FONT ID="LN">444 </FONT><A NAME="444"></A>   * 
<FONT ID="LN">445 </FONT><A NAME="445"></A>   * @param url the database url
<FONT ID="LN">446 </FONT><A NAME="446"></A>   * @param userName the user name
<FONT ID="LN">447 </FONT><A NAME="447"></A>   * @param password the password
<FONT ID="LN">448 </FONT><A NAME="448"></A>   */</FONT>  
<FONT ID="LN">449 </FONT><A NAME="449"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setSource(String url, String userName, String password){
<FONT ID="LN">450 </FONT><A NAME="450"></A>  
<FONT ID="LN">451 </FONT><A NAME="451"></A>      <FONT ID="Try">try</FONT>{
<FONT ID="LN">452 </FONT><A NAME="452"></A>        m_DataBaseConnection = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/converters/DatabaseConnection.java.html">DatabaseConnection</A>();
<FONT ID="LN">453 </FONT><A NAME="453"></A>        setUrl(url);
<FONT ID="LN">454 </FONT><A NAME="454"></A>        setUser(userName);
<FONT ID="LN">455 </FONT><A NAME="455"></A>        setPassword(password);
<FONT ID="LN">456 </FONT><A NAME="456"></A>      } <FONT ID="Catch">catch</FONT>(Exception ex) {
<FONT ID="LN">457 </FONT><A NAME="457"></A>            printException(ex);
<FONT ID="LN">458 </FONT><A NAME="458"></A>      }    
<FONT ID="LN">459 </FONT><A NAME="459"></A>  }
<FONT ID="LN">460 </FONT><A NAME="460"></A>  
<FONT ID="LN">461 </FONT><A NAME="461"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">462 </FONT><A NAME="462"></A>   * Sets the database url
<FONT ID="LN">463 </FONT><A NAME="463"></A>   * 
<FONT ID="LN">464 </FONT><A NAME="464"></A>   * @param url the database url
<FONT ID="LN">465 </FONT><A NAME="465"></A>   */</FONT>  
<FONT ID="LN">466 </FONT><A NAME="466"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setSource(String url){
<FONT ID="LN">467 </FONT><A NAME="467"></A>  
<FONT ID="LN">468 </FONT><A NAME="468"></A>      <FONT ID="Try">try</FONT>{
<FONT ID="LN">469 </FONT><A NAME="469"></A>        m_DataBaseConnection = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/converters/DatabaseConnection.java.html">DatabaseConnection</A>();
<FONT ID="LN">470 </FONT><A NAME="470"></A>        setUrl(url);
<FONT ID="LN">471 </FONT><A NAME="471"></A>        m_User = m_DataBaseConnection.getUsername();
<FONT ID="LN">472 </FONT><A NAME="472"></A>        m_Password = m_DataBaseConnection.getPassword();
<FONT ID="LN">473 </FONT><A NAME="473"></A>      } <FONT ID="Catch">catch</FONT>(Exception ex) {
<FONT ID="LN">474 </FONT><A NAME="474"></A>            printException(ex);
<FONT ID="LN">475 </FONT><A NAME="475"></A>       }    
<FONT ID="LN">476 </FONT><A NAME="476"></A>  }
<FONT ID="LN">477 </FONT><A NAME="477"></A>  
<FONT ID="LN">478 </FONT><A NAME="478"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">479 </FONT><A NAME="479"></A>   * Sets the database url using the DatabaseUtils file
<FONT ID="LN">480 </FONT><A NAME="480"></A>   * 
<FONT ID="LN">481 </FONT><A NAME="481"></A>   * @throws Exception if something goes wrong
<FONT ID="LN">482 </FONT><A NAME="482"></A>   */</FONT>  
<FONT ID="LN">483 </FONT><A NAME="483"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setSource() <FONT ID="Throws">throws</FONT> Exception{
<FONT ID="LN">484 </FONT><A NAME="484"></A>  
<FONT ID="LN">485 </FONT><A NAME="485"></A>        m_DataBaseConnection = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/converters/DatabaseConnection.java.html">DatabaseConnection</A>();
<FONT ID="LN">486 </FONT><A NAME="486"></A>        m_URL = m_DataBaseConnection.getDatabaseURL();
<FONT ID="LN">487 </FONT><A NAME="487"></A>        m_User = m_DataBaseConnection.getUsername();
<FONT ID="LN">488 </FONT><A NAME="488"></A>        m_Password = m_DataBaseConnection.getPassword();
<FONT ID="LN">489 </FONT><A NAME="489"></A>  }
<FONT ID="LN">490 </FONT><A NAME="490"></A>  
<FONT ID="LN">491 </FONT><A NAME="491"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">492 </FONT><A NAME="492"></A>   * Opens a connection to the database
<FONT ID="LN">493 </FONT><A NAME="493"></A>   */</FONT>
<FONT ID="LN">494 </FONT><A NAME="494"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> connectToDatabase() {
<FONT ID="LN">495 </FONT><A NAME="495"></A>   
<FONT ID="LN">496 </FONT><A NAME="496"></A>      <FONT ID="Try">try</FONT>{
<FONT ID="LN">497 </FONT><A NAME="497"></A>        <FONT ID="If">if</FONT>(!m_DataBaseConnection.isConnected()){
<FONT ID="LN">498 </FONT><A NAME="498"></A>            m_DataBaseConnection.connectToDatabase();
<FONT ID="LN">499 </FONT><A NAME="499"></A>        }
<FONT ID="LN">500 </FONT><A NAME="500"></A>      } <FONT ID="Catch">catch</FONT>(Exception ex) {
<FONT ID="LN">501 </FONT><A NAME="501"></A>    printException(ex);
<FONT ID="LN">502 </FONT><A NAME="502"></A>       }    
<FONT ID="LN">503 </FONT><A NAME="503"></A>  }
<FONT ID="LN">504 </FONT><A NAME="504"></A>  
<FONT ID="LN">505 </FONT><A NAME="505"></A>  
<FONT ID="LN">506 </FONT><A NAME="506"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">507 </FONT><A NAME="507"></A>   * Returns the table name or all after the FROM clause of the user specified query
<FONT ID="LN">508 </FONT><A NAME="508"></A>   * to retrieve instances.
<FONT ID="LN">509 </FONT><A NAME="509"></A>   * 
<FONT ID="LN">510 </FONT><A NAME="510"></A>   * @param onlyTableName true if only the table name should be returned, false otherwise
<FONT ID="LN">511 </FONT><A NAME="511"></A>   * @return the end of the query
<FONT ID="LN">512 </FONT><A NAME="512"></A>   */</FONT>  
<FONT ID="LN">513 </FONT><A NAME="513"></A>  <FONT ID="Private">private</FONT> String endOfQuery(<FONT ID="Boolean">boolean</FONT> onlyTableName){
<FONT ID="LN">514 </FONT><A NAME="514"></A>      String table;
<FONT ID="LN">515 </FONT><A NAME="515"></A>      <FONT ID="Int">int</FONT> beginIndex, endIndex;
<FONT ID="LN">516 </FONT><A NAME="516"></A>      
<FONT ID="LN">517 </FONT><A NAME="517"></A>      beginIndex = m_query.indexOf(<FONT ID="StringLiteral">"FROM "</FONT>)+<FONT ID="IntegerLiteral">5</FONT>;
<FONT ID="LN">518 </FONT><A NAME="518"></A>      <FONT ID="While">while</FONT>(m_query.charAt(beginIndex) == <FONT ID="CharacerLiteral">' '</FONT>)
<FONT ID="LN">519 </FONT><A NAME="519"></A>          beginIndex++;
<FONT ID="LN">520 </FONT><A NAME="520"></A>      endIndex = m_query.indexOf(<FONT ID="StringLiteral">" "</FONT>,beginIndex);
<FONT ID="LN">521 </FONT><A NAME="521"></A>      <FONT ID="If">if</FONT>(endIndex != -<FONT ID="IntegerLiteral">1</FONT> &amp;&amp; onlyTableName)
<FONT ID="LN">522 </FONT><A NAME="522"></A>          table = m_query.substring(beginIndex,endIndex);
<FONT ID="LN">523 </FONT><A NAME="523"></A>      <FONT ID="Else">else</FONT>
<FONT ID="LN">524 </FONT><A NAME="524"></A>          table = m_query.substring(beginIndex);
<FONT ID="LN">525 </FONT><A NAME="525"></A>      <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">526 </FONT><A NAME="526"></A>          table = table.toUpperCase();
<FONT ID="LN">527 </FONT><A NAME="527"></A>      <FONT ID="Return">return</FONT> table;
<FONT ID="LN">528 </FONT><A NAME="528"></A>  }
<FONT ID="LN">529 </FONT><A NAME="529"></A>  
<FONT ID="LN">530 </FONT><A NAME="530"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">531 </FONT><A NAME="531"></A>   * Checks for a unique key using the JDBC driver's method:
<FONT ID="LN">532 </FONT><A NAME="532"></A>   * getPrimaryKey(), getBestRowIdentifier().
<FONT ID="LN">533 </FONT><A NAME="533"></A>   * Depending on their implementation a key can be detected.
<FONT ID="LN">534 </FONT><A NAME="534"></A>   * The key is needed to order the instances uniquely for an inremental loading.
<FONT ID="LN">535 </FONT><A NAME="535"></A>   * If an existing key cannot be detected, use -P option.
<FONT ID="LN">536 </FONT><A NAME="536"></A>   * 
<FONT ID="LN">537 </FONT><A NAME="537"></A>   * @throws Exception if database error occurs
<FONT ID="LN">538 </FONT><A NAME="538"></A>   * @return true, if a key could have been detected, false otherwise
<FONT ID="LN">539 </FONT><A NAME="539"></A>   */</FONT>  
<FONT ID="LN">540 </FONT><A NAME="540"></A>  <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> checkForKey() <FONT ID="Throws">throws</FONT> Exception {
<FONT ID="LN">541 </FONT><A NAME="541"></A>  
<FONT ID="LN">542 </FONT><A NAME="542"></A>      String query = m_query;
<FONT ID="LN">543 </FONT><A NAME="543"></A>      
<FONT ID="LN">544 </FONT><A NAME="544"></A>      query = query.replaceAll(<FONT ID="StringLiteral">" +"</FONT>,<FONT ID="StringLiteral">" "</FONT>);
<FONT ID="LN">545 </FONT><A NAME="545"></A>      <FONT ID="SingleLineComment">//query has to use all columns
<FONT ID="LN">546 </FONT><A NAME="546"></A></FONT>      <FONT ID="If">if</FONT>(!query.startsWith(<FONT ID="StringLiteral">"SELECT *"</FONT>))
<FONT ID="LN">547 </FONT><A NAME="547"></A>          <FONT ID="Return">return</FONT> <FONT ID="False">false</FONT>;
<FONT ID="LN">548 </FONT><A NAME="548"></A>      m_orderBy.clear();
<FONT ID="LN">549 </FONT><A NAME="549"></A>      <FONT ID="If">if</FONT>(!m_DataBaseConnection.isConnected())
<FONT ID="LN">550 </FONT><A NAME="550"></A>            m_DataBaseConnection.connectToDatabase();
<FONT ID="LN">551 </FONT><A NAME="551"></A>      DatabaseMetaData dmd = m_DataBaseConnection.getMetaData();
<FONT ID="LN">552 </FONT><A NAME="552"></A>      String table = endOfQuery(<FONT ID="True">true</FONT>);
<FONT ID="LN">553 </FONT><A NAME="553"></A>      <FONT ID="SingleLineComment">//System.out.println(table);
<FONT ID="LN">554 </FONT><A NAME="554"></A></FONT>      <FONT ID="SingleLineComment">//check for primary keys
<FONT ID="LN">555 </FONT><A NAME="555"></A></FONT>      ResultSet rs = dmd.getPrimaryKeys(<FONT ID="Null">null</FONT>,<FONT ID="Null">null</FONT>,table);
<FONT ID="LN">556 </FONT><A NAME="556"></A>      <FONT ID="While">while</FONT>(rs.next()){
<FONT ID="LN">557 </FONT><A NAME="557"></A>          m_orderBy.add(rs.getString(<FONT ID="IntegerLiteral">4</FONT>));
<FONT ID="LN">558 </FONT><A NAME="558"></A>      }
<FONT ID="LN">559 </FONT><A NAME="559"></A>      rs.close();
<FONT ID="LN">560 </FONT><A NAME="560"></A>      <FONT ID="If">if</FONT>(m_orderBy.size() != <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">561 </FONT><A NAME="561"></A>          <FONT ID="Return">return</FONT> <FONT ID="True">true</FONT>;
<FONT ID="LN">562 </FONT><A NAME="562"></A>      <FONT ID="SingleLineComment">//check for unique keys
<FONT ID="LN">563 </FONT><A NAME="563"></A></FONT>      rs = dmd.getBestRowIdentifier(<FONT ID="Null">null</FONT>,<FONT ID="Null">null</FONT>,table,DatabaseMetaData.bestRowSession,<FONT ID="False">false</FONT>);
<FONT ID="LN">564 </FONT><A NAME="564"></A>      ResultSetMetaData rmd = rs.getMetaData();
<FONT ID="LN">565 </FONT><A NAME="565"></A>      <FONT ID="Int">int</FONT> help = <FONT ID="IntegerLiteral">0</FONT>;
<FONT ID="LN">566 </FONT><A NAME="566"></A>      <FONT ID="While">while</FONT>(rs.next()){
<FONT ID="LN">567 </FONT><A NAME="567"></A>          m_orderBy.add(rs.getString(<FONT ID="IntegerLiteral">2</FONT>));
<FONT ID="LN">568 </FONT><A NAME="568"></A>          help++;
<FONT ID="LN">569 </FONT><A NAME="569"></A>      }
<FONT ID="LN">570 </FONT><A NAME="570"></A>      rs.close();
<FONT ID="LN">571 </FONT><A NAME="571"></A>      <FONT ID="If">if</FONT>(help == rmd.getColumnCount()){
<FONT ID="LN">572 </FONT><A NAME="572"></A>          m_orderBy.clear();
<FONT ID="LN">573 </FONT><A NAME="573"></A>      }
<FONT ID="LN">574 </FONT><A NAME="574"></A>      <FONT ID="If">if</FONT>(m_orderBy.size() != <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">575 </FONT><A NAME="575"></A>          <FONT ID="Return">return</FONT> <FONT ID="True">true</FONT>;
<FONT ID="LN">576 </FONT><A NAME="576"></A>      
<FONT ID="LN">577 </FONT><A NAME="577"></A>      <FONT ID="Return">return</FONT> <FONT ID="False">false</FONT>;
<FONT ID="LN">578 </FONT><A NAME="578"></A>  }
<FONT ID="LN">579 </FONT><A NAME="579"></A>  
<FONT ID="LN">580 </FONT><A NAME="580"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">581 </FONT><A NAME="581"></A>   * Converts string attribute into nominal ones for an instance read during
<FONT ID="LN">582 </FONT><A NAME="582"></A>   * incremental loading
<FONT ID="LN">583 </FONT><A NAME="583"></A>   * 
<FONT ID="LN">584 </FONT><A NAME="584"></A>   * @param rs The result set
<FONT ID="LN">585 </FONT><A NAME="585"></A>   * @param i the index of the nominal attribute
<FONT ID="LN">586 </FONT><A NAME="586"></A>   * @throws Exception exception if it cannot be converted
<FONT ID="LN">587 </FONT><A NAME="587"></A>   */</FONT>  
<FONT ID="LN">588 </FONT><A NAME="588"></A>  <FONT ID="Private">private</FONT> <FONT ID="Void">void</FONT> stringToNominal(ResultSet rs, <FONT ID="Int">int</FONT> i) <FONT ID="Throws">throws</FONT> Exception{
<FONT ID="LN">589 </FONT><A NAME="589"></A>  
<FONT ID="LN">590 </FONT><A NAME="590"></A>      <FONT ID="While">while</FONT>(rs.next()){
<FONT ID="LN">591 </FONT><A NAME="591"></A>        String str = rs.getString(<FONT ID="IntegerLiteral">1</FONT>);
<FONT ID="LN">592 </FONT><A NAME="592"></A>        <FONT ID="If">if</FONT>(!rs.wasNull()){
<FONT ID="LN">593 </FONT><A NAME="593"></A>            Double index = (Double)m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].get(str);
<FONT ID="LN">594 </FONT><A NAME="594"></A>            <FONT ID="If">if</FONT> (index == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">595 </FONT><A NAME="595"></A>                index = <FONT ID="New">new</FONT> Double(m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>].size());
<FONT ID="LN">596 </FONT><A NAME="596"></A>                m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].put(str, index);
<FONT ID="LN">597 </FONT><A NAME="597"></A>                m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>].add(str);
<FONT ID="LN">598 </FONT><A NAME="598"></A>            }
<FONT ID="LN">599 </FONT><A NAME="599"></A>        }
<FONT ID="LN">600 </FONT><A NAME="600"></A>      }
<FONT ID="LN">601 </FONT><A NAME="601"></A>  }
<FONT ID="LN">602 </FONT><A NAME="602"></A>  
<FONT ID="LN">603 </FONT><A NAME="603"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">604 </FONT><A NAME="604"></A>   * Used in incremental loading. Modifies the SQL statement,
<FONT ID="LN">605 </FONT><A NAME="605"></A>   * so that only one instance per time is tretieved and the instances are ordered
<FONT ID="LN">606 </FONT><A NAME="606"></A>   * uniquely.
<FONT ID="LN">607 </FONT><A NAME="607"></A>   * 
<FONT ID="LN">608 </FONT><A NAME="608"></A>   * @param query the query to modify for incremental loading
<FONT ID="LN">609 </FONT><A NAME="609"></A>   * @param offset sets which tuple out of the uniquely ordered ones should be returned
<FONT ID="LN">610 </FONT><A NAME="610"></A>   * @param choice the kind of query that is suitable for the used DBMS
<FONT ID="LN">611 </FONT><A NAME="611"></A>   * @return the modified query that returns only one result tuple.
<FONT ID="LN">612 </FONT><A NAME="612"></A>   */</FONT>  
<FONT ID="LN">613 </FONT><A NAME="613"></A>  <FONT ID="Private">private</FONT> String limitQuery(String query, <FONT ID="Int">int</FONT> offset, <FONT ID="Int">int</FONT> choice){
<FONT ID="LN">614 </FONT><A NAME="614"></A>  
<FONT ID="LN">615 </FONT><A NAME="615"></A>      String limitedQuery;
<FONT ID="LN">616 </FONT><A NAME="616"></A>      StringBuffer order = <FONT ID="New">new</FONT> StringBuffer();
<FONT ID="LN">617 </FONT><A NAME="617"></A>      String orderByString = <FONT ID="StringLiteral">""</FONT>;
<FONT ID="LN">618 </FONT><A NAME="618"></A>      
<FONT ID="LN">619 </FONT><A NAME="619"></A>      <FONT ID="If">if</FONT>(m_orderBy.size() != <FONT ID="IntegerLiteral">0</FONT>){
<FONT ID="LN">620 </FONT><A NAME="620"></A>        order.append(<FONT ID="StringLiteral">" ORDER BY "</FONT>);
<FONT ID="LN">621 </FONT><A NAME="621"></A>        <FONT ID="For">for</FONT>(<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>; i &lt; m_orderBy.size()-<FONT ID="IntegerLiteral">1</FONT>; i++){
<FONT ID="LN">622 </FONT><A NAME="622"></A>            <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">623 </FONT><A NAME="623"></A>                order.append(((String)m_orderBy.get(i)).toUpperCase());
<FONT ID="LN">624 </FONT><A NAME="624"></A>            <FONT ID="Else">else</FONT>
<FONT ID="LN">625 </FONT><A NAME="625"></A>                order.append((String)m_orderBy.get(i));
<FONT ID="LN">626 </FONT><A NAME="626"></A>            order.append(<FONT ID="StringLiteral">", "</FONT>);
<FONT ID="LN">627 </FONT><A NAME="627"></A>        }
<FONT ID="LN">628 </FONT><A NAME="628"></A>        <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">629 </FONT><A NAME="629"></A>            order.append(((String)m_orderBy.get(m_orderBy.size()-<FONT ID="IntegerLiteral">1</FONT>)).toUpperCase());
<FONT ID="LN">630 </FONT><A NAME="630"></A>        <FONT ID="Else">else</FONT>
<FONT ID="LN">631 </FONT><A NAME="631"></A>            order.append((String)m_orderBy.get(m_orderBy.size()-<FONT ID="IntegerLiteral">1</FONT>));
<FONT ID="LN">632 </FONT><A NAME="632"></A>        orderByString = order.toString();
<FONT ID="LN">633 </FONT><A NAME="633"></A>      }
<FONT ID="LN">634 </FONT><A NAME="634"></A>      <FONT ID="If">if</FONT>(choice == <FONT ID="IntegerLiteral">0</FONT>){
<FONT ID="LN">635 </FONT><A NAME="635"></A>          limitedQuery = query.replaceFirst(<FONT ID="StringLiteral">"SELECT"</FONT>,<FONT ID="StringLiteral">"SELECT LIMIT "</FONT>+offset+<FONT ID="StringLiteral">" 1"</FONT>);
<FONT ID="LN">636 </FONT><A NAME="636"></A>          limitedQuery = limitedQuery.concat(orderByString);
<FONT ID="LN">637 </FONT><A NAME="637"></A>          <FONT ID="Return">return</FONT> limitedQuery;
<FONT ID="LN">638 </FONT><A NAME="638"></A>      }
<FONT ID="LN">639 </FONT><A NAME="639"></A>      <FONT ID="If">if</FONT>(choice == <FONT ID="IntegerLiteral">1</FONT>){
<FONT ID="LN">640 </FONT><A NAME="640"></A>          limitedQuery = query.concat(orderByString+<FONT ID="StringLiteral">" LIMIT 1 OFFSET "</FONT>+offset);
<FONT ID="LN">641 </FONT><A NAME="641"></A>          <FONT ID="Return">return</FONT> limitedQuery;
<FONT ID="LN">642 </FONT><A NAME="642"></A>      }
<FONT ID="LN">643 </FONT><A NAME="643"></A>      limitedQuery = query.concat(orderByString+<FONT ID="StringLiteral">" LIMIT "</FONT>+offset+<FONT ID="StringLiteral">", 1"</FONT>);
<FONT ID="LN">644 </FONT><A NAME="644"></A>      <FONT ID="SingleLineComment">//System.out.println(limitedQuery);
<FONT ID="LN">645 </FONT><A NAME="645"></A></FONT>      <FONT ID="Return">return</FONT> limitedQuery;
<FONT ID="LN">646 </FONT><A NAME="646"></A>  }
<FONT ID="LN">647 </FONT><A NAME="647"></A>  
<FONT ID="LN">648 </FONT><A NAME="648"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">649 </FONT><A NAME="649"></A>   * Counts the number of rows that are loaded from the database
<FONT ID="LN">650 </FONT><A NAME="650"></A>   * 
<FONT ID="LN">651 </FONT><A NAME="651"></A>   * @throws Exception if the number of rows cannot be calculated
<FONT ID="LN">652 </FONT><A NAME="652"></A>   * @return the entire number of rows
<FONT ID="LN">653 </FONT><A NAME="653"></A>   */</FONT>  
<FONT ID="LN">654 </FONT><A NAME="654"></A>  <FONT ID="Private">private</FONT> <FONT ID="Int">int</FONT> getRowCount() <FONT ID="Throws">throws</FONT> Exception{
<FONT ID="LN">655 </FONT><A NAME="655"></A>  
<FONT ID="LN">656 </FONT><A NAME="656"></A>    String query = <FONT ID="StringLiteral">"SELECT COUNT(*) FROM "</FONT>+endOfQuery(<FONT ID="False">false</FONT>);
<FONT ID="LN">657 </FONT><A NAME="657"></A>    <FONT ID="If">if</FONT>(m_DataBaseConnection.execute(query) == <FONT ID="False">false</FONT>) {
<FONT ID="LN">658 </FONT><A NAME="658"></A>        <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> Exception(<FONT ID="StringLiteral">"Cannot count results tuples."</FONT>);
<FONT ID="LN">659 </FONT><A NAME="659"></A>    }
<FONT ID="LN">660 </FONT><A NAME="660"></A>    ResultSet rs = m_DataBaseConnection.getResultSet();
<FONT ID="LN">661 </FONT><A NAME="661"></A>    rs.next();
<FONT ID="LN">662 </FONT><A NAME="662"></A>    <FONT ID="Int">int</FONT> i = rs.getInt(<FONT ID="IntegerLiteral">1</FONT>);
<FONT ID="LN">663 </FONT><A NAME="663"></A>    rs.close();
<FONT ID="LN">664 </FONT><A NAME="664"></A>    <FONT ID="Return">return</FONT> i;
<FONT ID="LN">665 </FONT><A NAME="665"></A>  }
<FONT ID="LN">666 </FONT><A NAME="666"></A>
<FONT ID="LN">667 </FONT><A NAME="667"></A>
<FONT ID="LN">668 </FONT><A NAME="668"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">669 </FONT><A NAME="669"></A>   * Determines and returns (if possible) the structure (internally the 
<FONT ID="LN">670 </FONT><A NAME="670"></A>   * header) of the data set as an empty set of instances.
<FONT ID="LN">671 </FONT><A NAME="671"></A>   *
<FONT ID="LN">672 </FONT><A NAME="672"></A>   * @return the structure of the data set as an empty set of Instances
<FONT ID="LN">673 </FONT><A NAME="673"></A>   * @throws IOException if an error occurs
<FONT ID="LN">674 </FONT><A NAME="674"></A>   */</FONT>
<FONT ID="LN">675 </FONT><A NAME="675"></A>  <FONT ID="Public">public</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A> getStructure() <FONT ID="Throws">throws</FONT> IOException {
<FONT ID="LN">676 </FONT><A NAME="676"></A>
<FONT ID="LN">677 </FONT><A NAME="677"></A>    <FONT ID="If">if</FONT> (m_DataBaseConnection == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">678 </FONT><A NAME="678"></A>      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"No source database has been specified"</FONT>);
<FONT ID="LN">679 </FONT><A NAME="679"></A>    }
<FONT ID="LN">680 </FONT><A NAME="680"></A>    connectToDatabase();
<FONT ID="LN">681 </FONT><A NAME="681"></A>  pseudo:
<FONT ID="LN">682 </FONT><A NAME="682"></A>      <FONT ID="Try">try</FONT>{
<FONT ID="LN">683 </FONT><A NAME="683"></A>    <FONT ID="If">if</FONT>(m_pseudoIncremental &amp;&amp; m_structure == <FONT ID="Null">null</FONT>){
<FONT ID="LN">684 </FONT><A NAME="684"></A>        <FONT ID="If">if</FONT> (getRetrieval() == BATCH) {
<FONT ID="LN">685 </FONT><A NAME="685"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"Cannot mix getting instances in both incremental and batch modes"</FONT>);
<FONT ID="LN">686 </FONT><A NAME="686"></A>        }
<FONT ID="LN">687 </FONT><A NAME="687"></A>        setRetrieval(NONE);  
<FONT ID="LN">688 </FONT><A NAME="688"></A>        m_datasetPseudoInc = getDataSet();
<FONT ID="LN">689 </FONT><A NAME="689"></A>        m_structure = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(m_datasetPseudoInc,<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">690 </FONT><A NAME="690"></A>        setRetrieval(NONE);
<FONT ID="LN">691 </FONT><A NAME="691"></A>        <FONT ID="Return">return</FONT> m_structure;
<FONT ID="LN">692 </FONT><A NAME="692"></A>    }
<FONT ID="LN">693 </FONT><A NAME="693"></A>    <FONT ID="If">if</FONT> (m_structure == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">694 </FONT><A NAME="694"></A>      <FONT ID="If">if</FONT>(m_checkForTable) {
<FONT ID="LN">695 </FONT><A NAME="695"></A>        <FONT ID="If">if</FONT>(!m_DataBaseConnection.tableExists(endOfQuery(<FONT ID="True">true</FONT>)))
<FONT ID="LN">696 </FONT><A NAME="696"></A>          <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(
<FONT ID="LN">697 </FONT><A NAME="697"></A>              <FONT ID="StringLiteral">"Table does not exist according to metadata from JDBC driver. "</FONT>
<FONT ID="LN">698 </FONT><A NAME="698"></A>              + <FONT ID="StringLiteral">"If you are convinced the table exists, set 'checkForTable' "</FONT>
<FONT ID="LN">699 </FONT><A NAME="699"></A>              + <FONT ID="StringLiteral">"to 'False' in your DatabaseUtils.props file and try again."</FONT>);
<FONT ID="LN">700 </FONT><A NAME="700"></A>      }
<FONT ID="LN">701 </FONT><A NAME="701"></A>        <FONT ID="SingleLineComment">//finds out which SQL statement to use for the DBMS to limit the number of resulting rows to one
<FONT ID="LN">702 </FONT><A NAME="702"></A></FONT>        <FONT ID="Int">int</FONT> choice = <FONT ID="IntegerLiteral">0</FONT>;
<FONT ID="LN">703 </FONT><A NAME="703"></A>        <FONT ID="Boolean">boolean</FONT> rightChoice = <FONT ID="False">false</FONT>;
<FONT ID="LN">704 </FONT><A NAME="704"></A>        <FONT ID="While">while</FONT> (!rightChoice){
<FONT ID="LN">705 </FONT><A NAME="705"></A>            <FONT ID="Try">try</FONT>{
<FONT ID="LN">706 </FONT><A NAME="706"></A>                <FONT ID="If">if</FONT> (m_DataBaseConnection.execute(limitQuery(m_query,<FONT ID="IntegerLiteral">0</FONT>,choice)) == <FONT ID="False">false</FONT>) {
<FONT ID="LN">707 </FONT><A NAME="707"></A>                    <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"Query didn't produce results"</FONT>);
<FONT ID="LN">708 </FONT><A NAME="708"></A>                }
<FONT ID="LN">709 </FONT><A NAME="709"></A>                m_choice = choice;
<FONT ID="LN">710 </FONT><A NAME="710"></A>                rightChoice = <FONT ID="True">true</FONT>;
<FONT ID="LN">711 </FONT><A NAME="711"></A>            }
<FONT ID="LN">712 </FONT><A NAME="712"></A>            <FONT ID="Catch">catch</FONT> (SQLException ex) {
<FONT ID="LN">713 </FONT><A NAME="713"></A>                choice++;
<FONT ID="LN">714 </FONT><A NAME="714"></A>                <FONT ID="If">if</FONT>(choice == <FONT ID="IntegerLiteral">3</FONT>){
<FONT ID="LN">715 </FONT><A NAME="715"></A>                    System.out.println(<FONT ID="StringLiteral">"Incremental loading not supported for that DBMS. Pseudoincremental mode is used if you use incremental loading.\nAll rows are loaded into memory once and retrieved incrementally from memory instead of from the database."</FONT>);
<FONT ID="LN">716 </FONT><A NAME="716"></A>                    m_pseudoIncremental = <FONT ID="True">true</FONT>;
<FONT ID="LN">717 </FONT><A NAME="717"></A>                    <FONT ID="Break">break</FONT> pseudo;
<FONT ID="LN">718 </FONT><A NAME="718"></A>                }
<FONT ID="LN">719 </FONT><A NAME="719"></A>            }
<FONT ID="LN">720 </FONT><A NAME="720"></A>        }
<FONT ID="LN">721 </FONT><A NAME="721"></A>        String end = endOfQuery(<FONT ID="False">false</FONT>);
<FONT ID="LN">722 </FONT><A NAME="722"></A>        ResultSet rs = m_DataBaseConnection.getResultSet();
<FONT ID="LN">723 </FONT><A NAME="723"></A>        ResultSetMetaData md = rs.getMetaData();
<FONT ID="LN">724 </FONT><A NAME="724"></A>        rs.close();
<FONT ID="LN">725 </FONT><A NAME="725"></A>        <FONT ID="Int">int</FONT> numAttributes = md.getColumnCount();
<FONT ID="LN">726 </FONT><A NAME="726"></A>        <FONT ID="Int">int</FONT> [] attributeTypes = <FONT ID="New">new</FONT> <FONT ID="Int">int</FONT> [numAttributes];
<FONT ID="LN">727 </FONT><A NAME="727"></A>        m_nominalIndexes = Utils.cast(<FONT ID="New">new</FONT> Hashtable [numAttributes]);
<FONT ID="LN">728 </FONT><A NAME="728"></A>        m_nominalStrings = Utils.cast(<FONT ID="New">new</FONT> ArrayList [numAttributes]);
<FONT ID="LN">729 </FONT><A NAME="729"></A>        <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">1</FONT>; i &lt;= numAttributes; i++) {
<FONT ID="LN">730 </FONT><A NAME="730"></A>            <FONT ID="Switch">switch</FONT> (m_DataBaseConnection.translateDBColumnType(md.getColumnTypeName(i))) {
<FONT ID="LN">731 </FONT><A NAME="731"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.STRING :
<FONT ID="LN">732 </FONT><A NAME="732"></A>                    <FONT ID="SingleLineComment">//System.err.println("String --&gt; nominal");
<FONT ID="LN">733 </FONT><A NAME="733"></A></FONT>                    ResultSet rs1;
<FONT ID="LN">734 </FONT><A NAME="734"></A>                    String columnName = md.getColumnName(i);
<FONT ID="LN">735 </FONT><A NAME="735"></A>                    <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">736 </FONT><A NAME="736"></A>                        columnName = columnName.toUpperCase();
<FONT ID="LN">737 </FONT><A NAME="737"></A>                    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> Hashtable&lt;String,Double&gt;();
<FONT ID="LN">738 </FONT><A NAME="738"></A>                    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">739 </FONT><A NAME="739"></A>                    String query = <FONT ID="StringLiteral">"SELECT COUNT(DISTINCT( "</FONT>+columnName+<FONT ID="StringLiteral">" )) FROM "</FONT> + end;
<FONT ID="LN">740 </FONT><A NAME="740"></A>                    <FONT ID="If">if</FONT> (m_DataBaseConnection.execute(query) == <FONT ID="True">true</FONT>){
<FONT ID="LN">741 </FONT><A NAME="741"></A>                        rs1 = m_DataBaseConnection.getResultSet();
<FONT ID="LN">742 </FONT><A NAME="742"></A>                        rs1.next();
<FONT ID="LN">743 </FONT><A NAME="743"></A>                        <FONT ID="Int">int</FONT> count = rs1.getInt(<FONT ID="IntegerLiteral">1</FONT>);
<FONT ID="LN">744 </FONT><A NAME="744"></A>                        rs1.close();
<FONT ID="LN">745 </FONT><A NAME="745"></A>                        <FONT ID="SingleLineComment">//                        if(count &gt; m_nominalToStringLimit || m_DataBaseConnection.execute("SELECT DISTINCT ( "+columnName+" ) FROM "+ end) == false){
<FONT ID="LN">746 </FONT><A NAME="746"></A></FONT>                        <FONT ID="If">if</FONT>(count &gt; m_nominalToStringLimit || 
<FONT ID="LN">747 </FONT><A NAME="747"></A>                           m_DataBaseConnection.execute(<FONT ID="StringLiteral">"SELECT DISTINCT ( "</FONT>
<FONT ID="LN">748 </FONT><A NAME="748"></A>                                                        + columnName
<FONT ID="LN">749 </FONT><A NAME="749"></A>                                                        + <FONT ID="StringLiteral">" ) FROM "</FONT>
<FONT ID="LN">750 </FONT><A NAME="750"></A>                                                        + end
<FONT ID="LN">751 </FONT><A NAME="751"></A>                                                        + <FONT ID="StringLiteral">" ORDER BY "</FONT>
<FONT ID="LN">752 </FONT><A NAME="752"></A>                                                        + columnName) == <FONT ID="False">false</FONT>){
<FONT ID="LN">753 </FONT><A NAME="753"></A>                            attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.STRING;
<FONT ID="LN">754 </FONT><A NAME="754"></A>                            <FONT ID="Break">break</FONT>;
<FONT ID="LN">755 </FONT><A NAME="755"></A>                        }
<FONT ID="LN">756 </FONT><A NAME="756"></A>                        rs1 = m_DataBaseConnection.getResultSet();
<FONT ID="LN">757 </FONT><A NAME="757"></A>                    }
<FONT ID="LN">758 </FONT><A NAME="758"></A>                    <FONT ID="Else">else</FONT>{
<FONT ID="LN">759 </FONT><A NAME="759"></A>                        <FONT ID="SingleLineComment">//System.err.println("Count for nominal values cannot be calculated. Attribute "+columnName+" treated as String.");
<FONT ID="LN">760 </FONT><A NAME="760"></A></FONT>                        attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.STRING;
<FONT ID="LN">761 </FONT><A NAME="761"></A>                        <FONT ID="Break">break</FONT>;
<FONT ID="LN">762 </FONT><A NAME="762"></A>                    }
<FONT ID="LN">763 </FONT><A NAME="763"></A>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NOMINAL;
<FONT ID="LN">764 </FONT><A NAME="764"></A>                    stringToNominal(rs1,i);
<FONT ID="LN">765 </FONT><A NAME="765"></A>                    rs1.close();
<FONT ID="LN">766 </FONT><A NAME="766"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">767 </FONT><A NAME="767"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.TEXT:
<FONT ID="LN">768 </FONT><A NAME="768"></A>                    <FONT ID="SingleLineComment">//System.err.println("boolean --&gt; string");
<FONT ID="LN">769 </FONT><A NAME="769"></A></FONT>                    columnName = md.getColumnName(i);
<FONT ID="LN">770 </FONT><A NAME="770"></A>                    <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">771 </FONT><A NAME="771"></A>                      columnName = columnName.toUpperCase();
<FONT ID="LN">772 </FONT><A NAME="772"></A>                    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> Hashtable&lt;String,Double&gt;();
<FONT ID="LN">773 </FONT><A NAME="773"></A>                    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">774 </FONT><A NAME="774"></A>                    query = <FONT ID="StringLiteral">"SELECT COUNT(DISTINCT( "</FONT>+columnName+<FONT ID="StringLiteral">" )) FROM "</FONT> + end;
<FONT ID="LN">775 </FONT><A NAME="775"></A>                    <FONT ID="If">if</FONT> (m_DataBaseConnection.execute(query) == <FONT ID="True">true</FONT>){
<FONT ID="LN">776 </FONT><A NAME="776"></A>                      rs1 = m_DataBaseConnection.getResultSet();
<FONT ID="LN">777 </FONT><A NAME="777"></A>                      stringToNominal(rs1,i);
<FONT ID="LN">778 </FONT><A NAME="778"></A>                      rs1.close();
<FONT ID="LN">779 </FONT><A NAME="779"></A>                    }
<FONT ID="LN">780 </FONT><A NAME="780"></A>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.STRING;
<FONT ID="LN">781 </FONT><A NAME="781"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">782 </FONT><A NAME="782"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.BOOL:
<FONT ID="LN">783 </FONT><A NAME="783"></A>                    <FONT ID="SingleLineComment">//System.err.println("boolean --&gt; nominal");
<FONT ID="LN">784 </FONT><A NAME="784"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NOMINAL;
<FONT ID="LN">785 </FONT><A NAME="785"></A>                    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> Hashtable&lt;String,Double&gt;();
<FONT ID="LN">786 </FONT><A NAME="786"></A>                    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].put(<FONT ID="StringLiteral">"false"</FONT>, <FONT ID="New">new</FONT> Double(<FONT ID="IntegerLiteral">0</FONT>));
<FONT ID="LN">787 </FONT><A NAME="787"></A>                    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].put(<FONT ID="StringLiteral">"true"</FONT>, <FONT ID="New">new</FONT> Double(<FONT ID="IntegerLiteral">1</FONT>));
<FONT ID="LN">788 </FONT><A NAME="788"></A>                    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">789 </FONT><A NAME="789"></A>                    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>].add(<FONT ID="StringLiteral">"false"</FONT>);
<FONT ID="LN">790 </FONT><A NAME="790"></A>                    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>].add(<FONT ID="StringLiteral">"true"</FONT>);
<FONT ID="LN">791 </FONT><A NAME="791"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">792 </FONT><A NAME="792"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.DOUBLE:
<FONT ID="LN">793 </FONT><A NAME="793"></A>                    <FONT ID="SingleLineComment">//System.err.println("BigDecimal --&gt; numeric");
<FONT ID="LN">794 </FONT><A NAME="794"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">795 </FONT><A NAME="795"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">796 </FONT><A NAME="796"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.BYTE:
<FONT ID="LN">797 </FONT><A NAME="797"></A>                    <FONT ID="SingleLineComment">//System.err.println("byte --&gt; numeric");
<FONT ID="LN">798 </FONT><A NAME="798"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">799 </FONT><A NAME="799"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">800 </FONT><A NAME="800"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.SHORT:
<FONT ID="LN">801 </FONT><A NAME="801"></A>                    <FONT ID="SingleLineComment">//System.err.println("short --&gt; numeric");
<FONT ID="LN">802 </FONT><A NAME="802"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">803 </FONT><A NAME="803"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">804 </FONT><A NAME="804"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.INTEGER:
<FONT ID="LN">805 </FONT><A NAME="805"></A>                    <FONT ID="SingleLineComment">//System.err.println("int --&gt; numeric");
<FONT ID="LN">806 </FONT><A NAME="806"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">807 </FONT><A NAME="807"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">808 </FONT><A NAME="808"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.LONG:
<FONT ID="LN">809 </FONT><A NAME="809"></A>                    <FONT ID="SingleLineComment">//System.err.println("long --&gt; numeric");
<FONT ID="LN">810 </FONT><A NAME="810"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">811 </FONT><A NAME="811"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">812 </FONT><A NAME="812"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.FLOAT:
<FONT ID="LN">813 </FONT><A NAME="813"></A>                    <FONT ID="SingleLineComment">//System.err.println("float --&gt; numeric");
<FONT ID="LN">814 </FONT><A NAME="814"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">815 </FONT><A NAME="815"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">816 </FONT><A NAME="816"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.DATE:
<FONT ID="LN">817 </FONT><A NAME="817"></A>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.DATE;
<FONT ID="LN">818 </FONT><A NAME="818"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">819 </FONT><A NAME="819"></A>                <FONT ID="Case">case</FONT> DatabaseConnection.TIME:
<FONT ID="LN">820 </FONT><A NAME="820"></A>                  attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.DATE;
<FONT ID="LN">821 </FONT><A NAME="821"></A>                  <FONT ID="Break">break</FONT>;
<FONT ID="LN">822 </FONT><A NAME="822"></A>                <FONT ID="Default">default</FONT>:
<FONT ID="LN">823 </FONT><A NAME="823"></A>                    <FONT ID="SingleLineComment">//System.err.println("Unknown column type");
<FONT ID="LN">824 </FONT><A NAME="824"></A></FONT>                    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.STRING;
<FONT ID="LN">825 </FONT><A NAME="825"></A>            }
<FONT ID="LN">826 </FONT><A NAME="826"></A>        }
<FONT ID="LN">827 </FONT><A NAME="827"></A>        ArrayList&lt;<A HREF="../../../weka/core/Attribute.java.html">Attribute</A>&gt; attribInfo = <FONT ID="New">new</FONT> ArrayList&lt;<A HREF="../../../weka/core/Attribute.java.html">Attribute</A>&gt;();
<FONT ID="LN">828 </FONT><A NAME="828"></A>        <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>; i &lt; numAttributes; i++) {
<FONT ID="LN">829 </FONT><A NAME="829"></A>            <FONT ID="MultiLineComment">/* Fix for databases that uppercase column names */</FONT>
<FONT ID="LN">830 </FONT><A NAME="830"></A>            <FONT ID="SingleLineComment">//String attribName = attributeCaseFix(md.getColumnName(i + 1));
<FONT ID="LN">831 </FONT><A NAME="831"></A></FONT>            String attribName = md.getColumnName(i + <FONT ID="IntegerLiteral">1</FONT>);
<FONT ID="LN">832 </FONT><A NAME="832"></A>            <FONT ID="Switch">switch</FONT> (attributeTypes[i]) {
<FONT ID="LN">833 </FONT><A NAME="833"></A>                <FONT ID="Case">case</FONT> Attribute.NOMINAL:
<FONT ID="LN">834 </FONT><A NAME="834"></A>                    attribInfo.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName, m_nominalStrings[i]));
<FONT ID="LN">835 </FONT><A NAME="835"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">836 </FONT><A NAME="836"></A>                <FONT ID="Case">case</FONT> Attribute.NUMERIC:
<FONT ID="LN">837 </FONT><A NAME="837"></A>                    attribInfo.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName));
<FONT ID="LN">838 </FONT><A NAME="838"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">839 </FONT><A NAME="839"></A>                <FONT ID="Case">case</FONT> Attribute.STRING:
<FONT ID="LN">840 </FONT><A NAME="840"></A>                    <A HREF="../../../weka/core/Attribute.java.html">Attribute</A> att = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName, (ArrayList&lt;String&gt;)<FONT ID="Null">null</FONT>);
<FONT ID="LN">841 </FONT><A NAME="841"></A>                    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> n = <FONT ID="IntegerLiteral">0</FONT>; n &lt; m_nominalStrings[i].size(); n++) {
<FONT ID="LN">842 </FONT><A NAME="842"></A>                      att.addStringValue((String) m_nominalStrings[i].get(n));
<FONT ID="LN">843 </FONT><A NAME="843"></A>                    }
<FONT ID="LN">844 </FONT><A NAME="844"></A>                    attribInfo.add(att);
<FONT ID="LN">845 </FONT><A NAME="845"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">846 </FONT><A NAME="846"></A>                <FONT ID="Case">case</FONT> Attribute.DATE:
<FONT ID="LN">847 </FONT><A NAME="847"></A>                    attribInfo.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName, (String)<FONT ID="Null">null</FONT>));
<FONT ID="LN">848 </FONT><A NAME="848"></A>                    <FONT ID="Break">break</FONT>;
<FONT ID="LN">849 </FONT><A NAME="849"></A>                <FONT ID="Default">default</FONT>:
<FONT ID="LN">850 </FONT><A NAME="850"></A>                    <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"Unknown attribute type"</FONT>);
<FONT ID="LN">851 </FONT><A NAME="851"></A>            }
<FONT ID="LN">852 </FONT><A NAME="852"></A>        }
<FONT ID="LN">853 </FONT><A NAME="853"></A>        m_structure = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(endOfQuery(<FONT ID="True">true</FONT>), attribInfo,<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">854 </FONT><A NAME="854"></A>        <FONT ID="SingleLineComment">//get rid of m_idColumn
<FONT ID="LN">855 </FONT><A NAME="855"></A></FONT>        <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">856 </FONT><A NAME="856"></A>              m_idColumn = m_idColumn.toUpperCase();
<FONT ID="LN">857 </FONT><A NAME="857"></A>        <FONT ID="SingleLineComment">//System.out.println(m_structure.attribute(0).name().equals(idColumn));
<FONT ID="LN">858 </FONT><A NAME="858"></A></FONT>        <FONT ID="If">if</FONT>(m_structure.attribute(<FONT ID="IntegerLiteral">0</FONT>).name().equals(m_idColumn)){
<FONT ID="LN">859 </FONT><A NAME="859"></A>            m_oldStructure = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(m_structure,<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">860 </FONT><A NAME="860"></A>            m_oldStructure.deleteAttributeAt(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">861 </FONT><A NAME="861"></A>            <FONT ID="SingleLineComment">//System.out.println(m_structure);
<FONT ID="LN">862 </FONT><A NAME="862"></A></FONT>        }
<FONT ID="LN">863 </FONT><A NAME="863"></A>        <FONT ID="Else">else</FONT>
<FONT ID="LN">864 </FONT><A NAME="864"></A>            m_oldStructure = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(m_structure,<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">865 </FONT><A NAME="865"></A>    }
<FONT ID="LN">866 </FONT><A NAME="866"></A>    <FONT ID="Else">else</FONT>{
<FONT ID="LN">867 </FONT><A NAME="867"></A>        <FONT ID="If">if</FONT>(m_oldStructure == <FONT ID="Null">null</FONT>)
<FONT ID="LN">868 </FONT><A NAME="868"></A>            m_oldStructure = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(m_structure,<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">869 </FONT><A NAME="869"></A>    }
<FONT ID="LN">870 </FONT><A NAME="870"></A>    m_DataBaseConnection.disconnectFromDatabase();
<FONT ID="LN">871 </FONT><A NAME="871"></A>    }
<FONT ID="LN">872 </FONT><A NAME="872"></A>    <FONT ID="Catch">catch</FONT>(Exception ex) {
<FONT ID="LN">873 </FONT><A NAME="873"></A>        ex.printStackTrace();
<FONT ID="LN">874 </FONT><A NAME="874"></A>    printException(ex);
<FONT ID="LN">875 </FONT><A NAME="875"></A>    } 
<FONT ID="LN">876 </FONT><A NAME="876"></A>    <FONT ID="Return">return</FONT> m_oldStructure;
<FONT ID="LN">877 </FONT><A NAME="877"></A>    
<FONT ID="LN">878 </FONT><A NAME="878"></A>  }
<FONT ID="LN">879 </FONT><A NAME="879"></A>  
<FONT ID="LN">880 </FONT><A NAME="880"></A>  
<FONT ID="LN">881 </FONT><A NAME="881"></A>
<FONT ID="LN">882 </FONT><A NAME="882"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">883 </FONT><A NAME="883"></A>   * Return the full data set in batch mode (header and all intances at once).
<FONT ID="LN">884 </FONT><A NAME="884"></A>   *
<FONT ID="LN">885 </FONT><A NAME="885"></A>   * @return the structure of the data set as an empty set of Instances
<FONT ID="LN">886 </FONT><A NAME="886"></A>   * @throws IOException if there is no source or parsing fails
<FONT ID="LN">887 </FONT><A NAME="887"></A>   */</FONT>
<FONT ID="LN">888 </FONT><A NAME="888"></A>  <FONT ID="Public">public</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A> getDataSet() <FONT ID="Throws">throws</FONT> IOException {
<FONT ID="LN">889 </FONT><A NAME="889"></A>
<FONT ID="LN">890 </FONT><A NAME="890"></A>    <FONT ID="If">if</FONT> (m_DataBaseConnection == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">891 </FONT><A NAME="891"></A>      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"No source database has been specified"</FONT>);
<FONT ID="LN">892 </FONT><A NAME="892"></A>    }
<FONT ID="LN">893 </FONT><A NAME="893"></A>    <FONT ID="If">if</FONT> (getRetrieval() == INCREMENTAL) {
<FONT ID="LN">894 </FONT><A NAME="894"></A>      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"Cannot mix getting Instances in both incremental and batch modes"</FONT>);
<FONT ID="LN">895 </FONT><A NAME="895"></A>    }
<FONT ID="LN">896 </FONT><A NAME="896"></A>    setRetrieval(BATCH);
<FONT ID="LN">897 </FONT><A NAME="897"></A>    connectToDatabase();
<FONT ID="LN">898 </FONT><A NAME="898"></A>    
<FONT ID="LN">899 </FONT><A NAME="899"></A>    
<FONT ID="LN">900 </FONT><A NAME="900"></A>    <A HREF="../../../weka/core/Instances.java.html">Instances</A> result = <FONT ID="Null">null</FONT>;
<FONT ID="LN">901 </FONT><A NAME="901"></A>    <FONT ID="Try">try</FONT>{
<FONT ID="LN">902 </FONT><A NAME="902"></A>    <FONT ID="If">if</FONT> (m_DataBaseConnection.execute(m_query) == <FONT ID="False">false</FONT>) 
<FONT ID="LN">903 </FONT><A NAME="903"></A>      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> Exception(<FONT ID="StringLiteral">"Query didn't produce results"</FONT>);
<FONT ID="LN">904 </FONT><A NAME="904"></A>    ResultSet rs = m_DataBaseConnection.getResultSet();
<FONT ID="LN">905 </FONT><A NAME="905"></A>    ResultSetMetaData md = rs.getMetaData();
<FONT ID="LN">906 </FONT><A NAME="906"></A>    <FONT ID="SingleLineComment">// Determine structure of the instances
<FONT ID="LN">907 </FONT><A NAME="907"></A></FONT>    <FONT ID="Int">int</FONT> numAttributes = md.getColumnCount();
<FONT ID="LN">908 </FONT><A NAME="908"></A>    <FONT ID="Int">int</FONT> [] attributeTypes = <FONT ID="New">new</FONT> <FONT ID="Int">int</FONT> [numAttributes];
<FONT ID="LN">909 </FONT><A NAME="909"></A>    m_nominalIndexes = Utils.cast(<FONT ID="New">new</FONT> Hashtable [numAttributes]);
<FONT ID="LN">910 </FONT><A NAME="910"></A>    m_nominalStrings = Utils.cast(<FONT ID="New">new</FONT> ArrayList [numAttributes]);
<FONT ID="LN">911 </FONT><A NAME="911"></A>    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">1</FONT>; i &lt;= numAttributes; i++) {
<FONT ID="LN">912 </FONT><A NAME="912"></A>      <FONT ID="Switch">switch</FONT> (m_DataBaseConnection.translateDBColumnType(md.getColumnTypeName(i))) {
<FONT ID="LN">913 </FONT><A NAME="913"></A>    
<FONT ID="LN">914 </FONT><A NAME="914"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.STRING :
<FONT ID="LN">915 </FONT><A NAME="915"></A>        ResultSet rs1;
<FONT ID="LN">916 </FONT><A NAME="916"></A>        String columnName = md.getColumnName(i);
<FONT ID="LN">917 </FONT><A NAME="917"></A>        <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">918 </FONT><A NAME="918"></A>            columnName = columnName.toUpperCase();
<FONT ID="LN">919 </FONT><A NAME="919"></A>        String end = endOfQuery(<FONT ID="False">false</FONT>);
<FONT ID="LN">920 </FONT><A NAME="920"></A>        m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> Hashtable&lt;String,Double&gt;();
<FONT ID="LN">921 </FONT><A NAME="921"></A>        m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">922 </FONT><A NAME="922"></A>        <FONT ID="If">if</FONT>(m_DataBaseConnection.execute(<FONT ID="StringLiteral">"SELECT DISTINCT ( "</FONT>
<FONT ID="LN">923 </FONT><A NAME="923"></A>                                        + columnName+<FONT ID="StringLiteral">" ) FROM "</FONT>
<FONT ID="LN">924 </FONT><A NAME="924"></A>                                        + end
<FONT ID="LN">925 </FONT><A NAME="925"></A>                                        + <FONT ID="StringLiteral">" ORDER BY "</FONT>
<FONT ID="LN">926 </FONT><A NAME="926"></A>                                        + columnName) == <FONT ID="False">false</FONT>){
<FONT ID="LN">927 </FONT><A NAME="927"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> Exception(<FONT ID="StringLiteral">"Nominal values cannot be retrieved"</FONT>);
<FONT ID="LN">928 </FONT><A NAME="928"></A>        }
<FONT ID="LN">929 </FONT><A NAME="929"></A>        rs1 = m_DataBaseConnection.getResultSet();
<FONT ID="LN">930 </FONT><A NAME="930"></A>        attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NOMINAL;
<FONT ID="LN">931 </FONT><A NAME="931"></A>        stringToNominal(rs1,i);
<FONT ID="LN">932 </FONT><A NAME="932"></A>        rs1.close();  
<FONT ID="LN">933 </FONT><A NAME="933"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">934 </FONT><A NAME="934"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.TEXT:
<FONT ID="LN">935 </FONT><A NAME="935"></A>        columnName = md.getColumnName(i);
<FONT ID="LN">936 </FONT><A NAME="936"></A>        <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">937 </FONT><A NAME="937"></A>            columnName = columnName.toUpperCase();
<FONT ID="LN">938 </FONT><A NAME="938"></A>        end = endOfQuery(<FONT ID="False">false</FONT>);
<FONT ID="LN">939 </FONT><A NAME="939"></A>        m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> Hashtable&lt;String,Double&gt;();
<FONT ID="LN">940 </FONT><A NAME="940"></A>        m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">941 </FONT><A NAME="941"></A>        <FONT ID="If">if</FONT>(m_DataBaseConnection.execute(<FONT ID="StringLiteral">"SELECT DISTINCT ( "</FONT>+columnName+<FONT ID="StringLiteral">" ) FROM "</FONT>+ end) == <FONT ID="False">false</FONT>){
<FONT ID="LN">942 </FONT><A NAME="942"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> Exception(<FONT ID="StringLiteral">"Nominal values cannot be retrieved"</FONT>);
<FONT ID="LN">943 </FONT><A NAME="943"></A>        }
<FONT ID="LN">944 </FONT><A NAME="944"></A>        rs1 = m_DataBaseConnection.getResultSet();
<FONT ID="LN">945 </FONT><A NAME="945"></A>        attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.STRING;
<FONT ID="LN">946 </FONT><A NAME="946"></A>        stringToNominal(rs1,i);
<FONT ID="LN">947 </FONT><A NAME="947"></A>        rs1.close();  
<FONT ID="LN">948 </FONT><A NAME="948"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">949 </FONT><A NAME="949"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.BOOL:
<FONT ID="LN">950 </FONT><A NAME="950"></A>    <FONT ID="SingleLineComment">//System.err.println("boolean --&gt; nominal");
<FONT ID="LN">951 </FONT><A NAME="951"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NOMINAL;
<FONT ID="LN">952 </FONT><A NAME="952"></A>    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> Hashtable&lt;String,Double&gt;();
<FONT ID="LN">953 </FONT><A NAME="953"></A>    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].put(<FONT ID="StringLiteral">"false"</FONT>, <FONT ID="New">new</FONT> Double(<FONT ID="IntegerLiteral">0</FONT>));
<FONT ID="LN">954 </FONT><A NAME="954"></A>    m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].put(<FONT ID="StringLiteral">"true"</FONT>, <FONT ID="New">new</FONT> Double(<FONT ID="IntegerLiteral">1</FONT>));
<FONT ID="LN">955 </FONT><A NAME="955"></A>    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>] = <FONT ID="New">new</FONT> ArrayList&lt;String&gt;();
<FONT ID="LN">956 </FONT><A NAME="956"></A>    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>].add(<FONT ID="StringLiteral">"false"</FONT>);
<FONT ID="LN">957 </FONT><A NAME="957"></A>    m_nominalStrings[i - <FONT ID="IntegerLiteral">1</FONT>].add(<FONT ID="StringLiteral">"true"</FONT>);
<FONT ID="LN">958 </FONT><A NAME="958"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">959 </FONT><A NAME="959"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.DOUBLE:
<FONT ID="LN">960 </FONT><A NAME="960"></A>    <FONT ID="SingleLineComment">//System.err.println("BigDecimal --&gt; numeric");
<FONT ID="LN">961 </FONT><A NAME="961"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">962 </FONT><A NAME="962"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">963 </FONT><A NAME="963"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.BYTE:
<FONT ID="LN">964 </FONT><A NAME="964"></A>    <FONT ID="SingleLineComment">//System.err.println("byte --&gt; numeric");
<FONT ID="LN">965 </FONT><A NAME="965"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">966 </FONT><A NAME="966"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">967 </FONT><A NAME="967"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.SHORT:
<FONT ID="LN">968 </FONT><A NAME="968"></A>    <FONT ID="SingleLineComment">//System.err.println("short --&gt; numeric");
<FONT ID="LN">969 </FONT><A NAME="969"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">970 </FONT><A NAME="970"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">971 </FONT><A NAME="971"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.INTEGER:
<FONT ID="LN">972 </FONT><A NAME="972"></A>    <FONT ID="SingleLineComment">//System.err.println("int --&gt; numeric");
<FONT ID="LN">973 </FONT><A NAME="973"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">974 </FONT><A NAME="974"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">975 </FONT><A NAME="975"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.LONG:
<FONT ID="LN">976 </FONT><A NAME="976"></A>    <FONT ID="SingleLineComment">//System.err.println("long --&gt; numeric");
<FONT ID="LN">977 </FONT><A NAME="977"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">978 </FONT><A NAME="978"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">979 </FONT><A NAME="979"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.FLOAT:
<FONT ID="LN">980 </FONT><A NAME="980"></A>    <FONT ID="SingleLineComment">//System.err.println("float --&gt; numeric");
<FONT ID="LN">981 </FONT><A NAME="981"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.NUMERIC;
<FONT ID="LN">982 </FONT><A NAME="982"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">983 </FONT><A NAME="983"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.DATE:
<FONT ID="LN">984 </FONT><A NAME="984"></A>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.DATE;
<FONT ID="LN">985 </FONT><A NAME="985"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">986 </FONT><A NAME="986"></A>      <FONT ID="Case">case</FONT> DatabaseConnection.TIME:
<FONT ID="LN">987 </FONT><A NAME="987"></A>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.DATE;
<FONT ID="LN">988 </FONT><A NAME="988"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">989 </FONT><A NAME="989"></A>      <FONT ID="Default">default</FONT>:
<FONT ID="LN">990 </FONT><A NAME="990"></A>    <FONT ID="SingleLineComment">//System.err.println("Unknown column type");
<FONT ID="LN">991 </FONT><A NAME="991"></A></FONT>    attributeTypes[i - <FONT ID="IntegerLiteral">1</FONT>] = Attribute.STRING;
<FONT ID="LN">992 </FONT><A NAME="992"></A>      }
<FONT ID="LN">993 </FONT><A NAME="993"></A>    }
<FONT ID="LN">994 </FONT><A NAME="994"></A>
<FONT ID="LN">995 </FONT><A NAME="995"></A>    <FONT ID="SingleLineComment">// Step through the tuples
<FONT ID="LN">996 </FONT><A NAME="996"></A></FONT>    <FONT ID="SingleLineComment">//System.err.println("Creating instances...");
<FONT ID="LN">997 </FONT><A NAME="997"></A></FONT>    ArrayList&lt;<A HREF="../../../weka/core/Instance.java.html">Instance</A>&gt; instances = <FONT ID="New">new</FONT> ArrayList&lt;<A HREF="../../../weka/core/Instance.java.html">Instance</A>&gt;();
<FONT ID="LN">998 </FONT><A NAME="998"></A>    <FONT ID="While">while</FONT>(rs.next()) {
<FONT ID="LN">999 </FONT><A NAME="999"></A>      <FONT ID="Double">double</FONT>[] vals = <FONT ID="New">new</FONT> <FONT ID="Double">double</FONT>[numAttributes];
<FONT ID="LN">1000</FONT><A NAME="1000"></A>      <FONT ID="For">for</FONT>(<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">1</FONT>; i &lt;= numAttributes; i++) {
<FONT ID="LN">1001</FONT><A NAME="1001"></A>    <FONT ID="Switch">switch</FONT> (m_DataBaseConnection.translateDBColumnType(md.getColumnTypeName(i))) {
<FONT ID="LN">1002</FONT><A NAME="1002"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.STRING :
<FONT ID="LN">1003</FONT><A NAME="1003"></A>      String str = rs.getString(i);
<FONT ID="LN">1004</FONT><A NAME="1004"></A>      
<FONT ID="LN">1005</FONT><A NAME="1005"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1006</FONT><A NAME="1006"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1007</FONT><A NAME="1007"></A>            } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1008</FONT><A NAME="1008"></A>                Double index = (Double)m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].get(str);
<FONT ID="LN">1009</FONT><A NAME="1009"></A>                <FONT ID="If">if</FONT> (index == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">1010</FONT><A NAME="1010"></A>                    index = <FONT ID="New">new</FONT> Double(m_structure.attribute(i-<FONT ID="IntegerLiteral">1</FONT>).addStringValue(str));
<FONT ID="LN">1011</FONT><A NAME="1011"></A>                }
<FONT ID="LN">1012</FONT><A NAME="1012"></A>                vals[i - <FONT ID="IntegerLiteral">1</FONT>] = index.doubleValue();
<FONT ID="LN">1013</FONT><A NAME="1013"></A>            }
<FONT ID="LN">1014</FONT><A NAME="1014"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1015</FONT><A NAME="1015"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.TEXT:
<FONT ID="LN">1016</FONT><A NAME="1016"></A>      str = rs.getString(i);
<FONT ID="LN">1017</FONT><A NAME="1017"></A>
<FONT ID="LN">1018</FONT><A NAME="1018"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1019</FONT><A NAME="1019"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1020</FONT><A NAME="1020"></A>      }
<FONT ID="LN">1021</FONT><A NAME="1021"></A>      <FONT ID="Else">else</FONT> {
<FONT ID="LN">1022</FONT><A NAME="1022"></A>        Double index = (Double)m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].get(str);
<FONT ID="LN">1023</FONT><A NAME="1023"></A>        <FONT ID="If">if</FONT> (index == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">1024</FONT><A NAME="1024"></A>          index = <FONT ID="New">new</FONT> Double(m_structure.attribute(i-<FONT ID="IntegerLiteral">1</FONT>).addStringValue(str));
<FONT ID="LN">1025</FONT><A NAME="1025"></A>        }
<FONT ID="LN">1026</FONT><A NAME="1026"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = index.doubleValue();
<FONT ID="LN">1027</FONT><A NAME="1027"></A>      }
<FONT ID="LN">1028</FONT><A NAME="1028"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1029</FONT><A NAME="1029"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.BOOL:
<FONT ID="LN">1030</FONT><A NAME="1030"></A>      <FONT ID="Boolean">boolean</FONT> boo = rs.getBoolean(i);
<FONT ID="LN">1031</FONT><A NAME="1031"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1032</FONT><A NAME="1032"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1033</FONT><A NAME="1033"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1034</FONT><A NAME="1034"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (boo ? <FONT ID="FloatPointLiteral">1.0</FONT> : <FONT ID="FloatPointLiteral">0.0</FONT>);
<FONT ID="LN">1035</FONT><A NAME="1035"></A>      }
<FONT ID="LN">1036</FONT><A NAME="1036"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1037</FONT><A NAME="1037"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.DOUBLE:
<FONT ID="LN">1038</FONT><A NAME="1038"></A>      <FONT ID="Double">double</FONT> dd = rs.getDouble(i);
<FONT ID="LN">1039</FONT><A NAME="1039"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1040</FONT><A NAME="1040"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1041</FONT><A NAME="1041"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1042</FONT><A NAME="1042"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] =  dd;
<FONT ID="LN">1043</FONT><A NAME="1043"></A>      }
<FONT ID="LN">1044</FONT><A NAME="1044"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1045</FONT><A NAME="1045"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.BYTE:
<FONT ID="LN">1046</FONT><A NAME="1046"></A>      <FONT ID="Byte">byte</FONT> by = rs.getByte(i);
<FONT ID="LN">1047</FONT><A NAME="1047"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1048</FONT><A NAME="1048"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1049</FONT><A NAME="1049"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1050</FONT><A NAME="1050"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)by;
<FONT ID="LN">1051</FONT><A NAME="1051"></A>      }
<FONT ID="LN">1052</FONT><A NAME="1052"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1053</FONT><A NAME="1053"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.SHORT:
<FONT ID="LN">1054</FONT><A NAME="1054"></A>      <FONT ID="Short">short</FONT> sh = rs.getShort(i);
<FONT ID="LN">1055</FONT><A NAME="1055"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1056</FONT><A NAME="1056"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1057</FONT><A NAME="1057"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1058</FONT><A NAME="1058"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)sh;
<FONT ID="LN">1059</FONT><A NAME="1059"></A>      }
<FONT ID="LN">1060</FONT><A NAME="1060"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1061</FONT><A NAME="1061"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.INTEGER:
<FONT ID="LN">1062</FONT><A NAME="1062"></A>      <FONT ID="Int">int</FONT> in = rs.getInt(i);
<FONT ID="LN">1063</FONT><A NAME="1063"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1064</FONT><A NAME="1064"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1065</FONT><A NAME="1065"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1066</FONT><A NAME="1066"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)in;
<FONT ID="LN">1067</FONT><A NAME="1067"></A>      }
<FONT ID="LN">1068</FONT><A NAME="1068"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1069</FONT><A NAME="1069"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.LONG:
<FONT ID="LN">1070</FONT><A NAME="1070"></A>      <FONT ID="Long">long</FONT> lo = rs.getLong(i);
<FONT ID="LN">1071</FONT><A NAME="1071"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1072</FONT><A NAME="1072"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1073</FONT><A NAME="1073"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1074</FONT><A NAME="1074"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)lo;
<FONT ID="LN">1075</FONT><A NAME="1075"></A>      }
<FONT ID="LN">1076</FONT><A NAME="1076"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1077</FONT><A NAME="1077"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.FLOAT:
<FONT ID="LN">1078</FONT><A NAME="1078"></A>      <FONT ID="Float">float</FONT> fl = rs.getFloat(i);
<FONT ID="LN">1079</FONT><A NAME="1079"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1080</FONT><A NAME="1080"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1081</FONT><A NAME="1081"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1082</FONT><A NAME="1082"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)fl;
<FONT ID="LN">1083</FONT><A NAME="1083"></A>      }
<FONT ID="LN">1084</FONT><A NAME="1084"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1085</FONT><A NAME="1085"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.DATE:
<FONT ID="LN">1086</FONT><A NAME="1086"></A>          Date date = rs.getDate(i);
<FONT ID="LN">1087</FONT><A NAME="1087"></A>          <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1088</FONT><A NAME="1088"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1089</FONT><A NAME="1089"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1090</FONT><A NAME="1090"></A>            <FONT ID="SingleLineComment">// TODO: Do a value check here.
<FONT ID="LN">1091</FONT><A NAME="1091"></A></FONT>            vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)date.getTime();
<FONT ID="LN">1092</FONT><A NAME="1092"></A>          }
<FONT ID="LN">1093</FONT><A NAME="1093"></A>          <FONT ID="Break">break</FONT>;
<FONT ID="LN">1094</FONT><A NAME="1094"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.TIME:
<FONT ID="LN">1095</FONT><A NAME="1095"></A>          Time time = rs.getTime(i);
<FONT ID="LN">1096</FONT><A NAME="1096"></A>          <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1097</FONT><A NAME="1097"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1098</FONT><A NAME="1098"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1099</FONT><A NAME="1099"></A>            <FONT ID="SingleLineComment">// TODO: Do a value check here.
<FONT ID="LN">1100</FONT><A NAME="1100"></A></FONT>            vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>) time.getTime();
<FONT ID="LN">1101</FONT><A NAME="1101"></A>          }
<FONT ID="LN">1102</FONT><A NAME="1102"></A>          <FONT ID="Break">break</FONT>;
<FONT ID="LN">1103</FONT><A NAME="1103"></A>    <FONT ID="Default">default</FONT>:
<FONT ID="LN">1104</FONT><A NAME="1104"></A>      vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1105</FONT><A NAME="1105"></A>    }
<FONT ID="LN">1106</FONT><A NAME="1106"></A>      }
<FONT ID="LN">1107</FONT><A NAME="1107"></A>      <A HREF="../../../weka/core/Instance.java.html">Instance</A> newInst;
<FONT ID="LN">1108</FONT><A NAME="1108"></A>      newInst = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/DenseInstance.java.html">DenseInstance</A>(<FONT ID="FloatPointLiteral">1.0</FONT>, vals);
<FONT ID="LN">1109</FONT><A NAME="1109"></A>      instances.add(newInst);
<FONT ID="LN">1110</FONT><A NAME="1110"></A>    }   
<FONT ID="LN">1111</FONT><A NAME="1111"></A>    
<FONT ID="LN">1112</FONT><A NAME="1112"></A>    <FONT ID="SingleLineComment">// Create the header and add the instances to the dataset
<FONT ID="LN">1113</FONT><A NAME="1113"></A></FONT>    <FONT ID="SingleLineComment">//System.err.println("Creating header...");
<FONT ID="LN">1114</FONT><A NAME="1114"></A></FONT>    ArrayList&lt;<A HREF="../../../weka/core/Attribute.java.html">Attribute</A>&gt; attribInfo = <FONT ID="New">new</FONT> ArrayList&lt;<A HREF="../../../weka/core/Attribute.java.html">Attribute</A>&gt;();
<FONT ID="LN">1115</FONT><A NAME="1115"></A>    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>; i &lt; numAttributes; i++) {
<FONT ID="LN">1116</FONT><A NAME="1116"></A>      <FONT ID="MultiLineComment">/* Fix for databases that uppercase column names */</FONT>
<FONT ID="LN">1117</FONT><A NAME="1117"></A>      <FONT ID="SingleLineComment">//String attribName = attributeCaseFix(md.getColumnName(i + 1));
<FONT ID="LN">1118</FONT><A NAME="1118"></A></FONT>      String attribName = md.getColumnName(i + <FONT ID="IntegerLiteral">1</FONT>);
<FONT ID="LN">1119</FONT><A NAME="1119"></A>      <FONT ID="Switch">switch</FONT> (attributeTypes[i]) {
<FONT ID="LN">1120</FONT><A NAME="1120"></A>      <FONT ID="Case">case</FONT> Attribute.NOMINAL:
<FONT ID="LN">1121</FONT><A NAME="1121"></A>    attribInfo.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName, m_nominalStrings[i]));
<FONT ID="LN">1122</FONT><A NAME="1122"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">1123</FONT><A NAME="1123"></A>      <FONT ID="Case">case</FONT> Attribute.NUMERIC:
<FONT ID="LN">1124</FONT><A NAME="1124"></A>    attribInfo.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName));
<FONT ID="LN">1125</FONT><A NAME="1125"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">1126</FONT><A NAME="1126"></A>      <FONT ID="Case">case</FONT> Attribute.STRING:
<FONT ID="LN">1127</FONT><A NAME="1127"></A>    <A HREF="../../../weka/core/Attribute.java.html">Attribute</A> att = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName, (ArrayList&lt;String&gt;) <FONT ID="Null">null</FONT>);
<FONT ID="LN">1128</FONT><A NAME="1128"></A>    attribInfo.add(att);
<FONT ID="LN">1129</FONT><A NAME="1129"></A>    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> n = <FONT ID="IntegerLiteral">0</FONT>; n &lt; m_nominalStrings[i].size(); n++) {
<FONT ID="LN">1130</FONT><A NAME="1130"></A>      att.addStringValue((String) m_nominalStrings[i].get(n));
<FONT ID="LN">1131</FONT><A NAME="1131"></A>    }
<FONT ID="LN">1132</FONT><A NAME="1132"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">1133</FONT><A NAME="1133"></A>      <FONT ID="Case">case</FONT> Attribute.DATE:
<FONT ID="LN">1134</FONT><A NAME="1134"></A>    attribInfo.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Attribute.java.html">Attribute</A>(attribName, (String)<FONT ID="Null">null</FONT>));
<FONT ID="LN">1135</FONT><A NAME="1135"></A>    <FONT ID="Break">break</FONT>;
<FONT ID="LN">1136</FONT><A NAME="1136"></A>      <FONT ID="Default">default</FONT>:
<FONT ID="LN">1137</FONT><A NAME="1137"></A>    <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"Unknown attribute type"</FONT>);
<FONT ID="LN">1138</FONT><A NAME="1138"></A>      }
<FONT ID="LN">1139</FONT><A NAME="1139"></A>    }
<FONT ID="LN">1140</FONT><A NAME="1140"></A>    result = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(endOfQuery(<FONT ID="True">true</FONT>), attribInfo, 
<FONT ID="LN">1141</FONT><A NAME="1141"></A>                     instances.size());
<FONT ID="LN">1142</FONT><A NAME="1142"></A>    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>; i &lt; instances.size(); i++) {
<FONT ID="LN">1143</FONT><A NAME="1143"></A>      result.add((<A HREF="../../../weka/core/Instance.java.html">Instance</A>)instances.get(i));
<FONT ID="LN">1144</FONT><A NAME="1144"></A>    }
<FONT ID="LN">1145</FONT><A NAME="1145"></A>    rs.close();
<FONT ID="LN">1146</FONT><A NAME="1146"></A>    m_DataBaseConnection.disconnectFromDatabase();
<FONT ID="LN">1147</FONT><A NAME="1147"></A>    <FONT ID="SingleLineComment">//get rid of m_idColumn
<FONT ID="LN">1148</FONT><A NAME="1148"></A></FONT>    <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">1149</FONT><A NAME="1149"></A>        m_idColumn = m_idColumn.toUpperCase();
<FONT ID="LN">1150</FONT><A NAME="1150"></A>    <FONT ID="If">if</FONT>(result.attribute(<FONT ID="IntegerLiteral">0</FONT>).name().equals(m_idColumn)){
<FONT ID="LN">1151</FONT><A NAME="1151"></A>        result.deleteAttributeAt(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1152</FONT><A NAME="1152"></A>    }
<FONT ID="LN">1153</FONT><A NAME="1153"></A>    m_structure = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/Instances.java.html">Instances</A>(result,<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1154</FONT><A NAME="1154"></A>    }
<FONT ID="LN">1155</FONT><A NAME="1155"></A>    <FONT ID="Catch">catch</FONT>(Exception ex) {
<FONT ID="LN">1156</FONT><A NAME="1156"></A>    printException(ex);
<FONT ID="LN">1157</FONT><A NAME="1157"></A>        StringBuffer text = <FONT ID="New">new</FONT> StringBuffer();
<FONT ID="LN">1158</FONT><A NAME="1158"></A>        <FONT ID="If">if</FONT>(m_query.equals(<FONT ID="StringLiteral">"Select * from Results0"</FONT>)){
<FONT ID="LN">1159</FONT><A NAME="1159"></A>            text.append(<FONT ID="StringLiteral">"\n\nDatabaseLoader options:\n"</FONT>);
<FONT ID="LN">1160</FONT><A NAME="1160"></A>            Enumeration enumi = listOptions();
<FONT ID="LN">1161</FONT><A NAME="1161"></A>            <FONT ID="While">while</FONT> (enumi.hasMoreElements()) {
<FONT ID="LN">1162</FONT><A NAME="1162"></A>                <A HREF="../../../weka/core/Option.java.html">Option</A> option = (<A HREF="../../../weka/core/Option.java.html">Option</A>)enumi.nextElement();
<FONT ID="LN">1163</FONT><A NAME="1163"></A>                text.append(option.synopsis()+<FONT ID="CharacerLiteral">'\n'</FONT>);
<FONT ID="LN">1164</FONT><A NAME="1164"></A>                text.append(option.description()+<FONT ID="CharacerLiteral">'\n'</FONT>);
<FONT ID="LN">1165</FONT><A NAME="1165"></A>            }
<FONT ID="LN">1166</FONT><A NAME="1166"></A>            System.out.println(text);
<FONT ID="LN">1167</FONT><A NAME="1167"></A>        }
<FONT ID="LN">1168</FONT><A NAME="1168"></A>    }
<FONT ID="LN">1169</FONT><A NAME="1169"></A>    <FONT ID="SingleLineComment">//System.out.println(result);
<FONT ID="LN">1170</FONT><A NAME="1170"></A></FONT>    <FONT ID="Return">return</FONT> result;
<FONT ID="LN">1171</FONT><A NAME="1171"></A>  }
<FONT ID="LN">1172</FONT><A NAME="1172"></A>  
<FONT ID="LN">1173</FONT><A NAME="1173"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">1174</FONT><A NAME="1174"></A>   * Reads an instance from a database.
<FONT ID="LN">1175</FONT><A NAME="1175"></A>   * 
<FONT ID="LN">1176</FONT><A NAME="1176"></A>   * @param rs the ReusltSet to load
<FONT ID="LN">1177</FONT><A NAME="1177"></A>   * @throws Exception if instance cannot be read
<FONT ID="LN">1178</FONT><A NAME="1178"></A>   * @return an instance read from the database
<FONT ID="LN">1179</FONT><A NAME="1179"></A>   */</FONT>  
<FONT ID="LN">1180</FONT><A NAME="1180"></A>  <FONT ID="Private">private</FONT> <A HREF="../../../weka/core/Instance.java.html">Instance</A> readInstance(ResultSet rs) <FONT ID="Throws">throws</FONT> Exception{
<FONT ID="LN">1181</FONT><A NAME="1181"></A>  
<FONT ID="LN">1182</FONT><A NAME="1182"></A>      ResultSetMetaData md = rs.getMetaData();
<FONT ID="LN">1183</FONT><A NAME="1183"></A>      <FONT ID="Int">int</FONT> numAttributes = md.getColumnCount();
<FONT ID="LN">1184</FONT><A NAME="1184"></A>      <FONT ID="Double">double</FONT>[] vals = <FONT ID="New">new</FONT> <FONT ID="Double">double</FONT>[numAttributes];
<FONT ID="LN">1185</FONT><A NAME="1185"></A>      m_structure.delete();
<FONT ID="LN">1186</FONT><A NAME="1186"></A>      <FONT ID="For">for</FONT>(<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">1</FONT>; i &lt;= numAttributes; i++) {
<FONT ID="LN">1187</FONT><A NAME="1187"></A>    <FONT ID="Switch">switch</FONT> (m_DataBaseConnection.translateDBColumnType(md.getColumnTypeName(i))) {
<FONT ID="LN">1188</FONT><A NAME="1188"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.STRING :
<FONT ID="LN">1189</FONT><A NAME="1189"></A>      String str = rs.getString(i);
<FONT ID="LN">1190</FONT><A NAME="1190"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1191</FONT><A NAME="1191"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1192</FONT><A NAME="1192"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1193</FONT><A NAME="1193"></A>        Double index = (Double)m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].get(str);
<FONT ID="LN">1194</FONT><A NAME="1194"></A>        <FONT ID="If">if</FONT> (index == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">1195</FONT><A NAME="1195"></A>              index = <FONT ID="New">new</FONT> Double(m_structure.attribute(i-<FONT ID="IntegerLiteral">1</FONT>).addStringValue(str));
<FONT ID="LN">1196</FONT><A NAME="1196"></A>        }
<FONT ID="LN">1197</FONT><A NAME="1197"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = index.doubleValue();
<FONT ID="LN">1198</FONT><A NAME="1198"></A>      }
<FONT ID="LN">1199</FONT><A NAME="1199"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1200</FONT><A NAME="1200"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.TEXT:
<FONT ID="LN">1201</FONT><A NAME="1201"></A>      str = rs.getString(i);
<FONT ID="LN">1202</FONT><A NAME="1202"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1203</FONT><A NAME="1203"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1204</FONT><A NAME="1204"></A>      }
<FONT ID="LN">1205</FONT><A NAME="1205"></A>      <FONT ID="Else">else</FONT> {
<FONT ID="LN">1206</FONT><A NAME="1206"></A>        Double index = (Double)m_nominalIndexes[i - <FONT ID="IntegerLiteral">1</FONT>].get(str);
<FONT ID="LN">1207</FONT><A NAME="1207"></A>        <FONT ID="If">if</FONT> (index == <FONT ID="Null">null</FONT>) {
<FONT ID="LN">1208</FONT><A NAME="1208"></A>              index = <FONT ID="New">new</FONT> Double(m_structure.attribute(i-<FONT ID="IntegerLiteral">1</FONT>).addStringValue(str));
<FONT ID="LN">1209</FONT><A NAME="1209"></A>        }
<FONT ID="LN">1210</FONT><A NAME="1210"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = index.doubleValue();
<FONT ID="LN">1211</FONT><A NAME="1211"></A>      }
<FONT ID="LN">1212</FONT><A NAME="1212"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1213</FONT><A NAME="1213"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.BOOL:
<FONT ID="LN">1214</FONT><A NAME="1214"></A>      <FONT ID="Boolean">boolean</FONT> boo = rs.getBoolean(i);
<FONT ID="LN">1215</FONT><A NAME="1215"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1216</FONT><A NAME="1216"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1217</FONT><A NAME="1217"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1218</FONT><A NAME="1218"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (boo ? <FONT ID="FloatPointLiteral">1.0</FONT> : <FONT ID="FloatPointLiteral">0.0</FONT>);
<FONT ID="LN">1219</FONT><A NAME="1219"></A>      }
<FONT ID="LN">1220</FONT><A NAME="1220"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1221</FONT><A NAME="1221"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.DOUBLE:
<FONT ID="LN">1222</FONT><A NAME="1222"></A>      <FONT ID="SingleLineComment">//      BigDecimal bd = rs.getBigDecimal(i, 4); 
<FONT ID="LN">1223</FONT><A NAME="1223"></A></FONT>      <FONT ID="Double">double</FONT> dd = rs.getDouble(i);
<FONT ID="LN">1224</FONT><A NAME="1224"></A>      <FONT ID="SingleLineComment">// Use the column precision instead of 4?
<FONT ID="LN">1225</FONT><A NAME="1225"></A></FONT>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1226</FONT><A NAME="1226"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1227</FONT><A NAME="1227"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1228</FONT><A NAME="1228"></A>        <FONT ID="SingleLineComment">//      newInst.setValue(i - 1, bd.doubleValue());
<FONT ID="LN">1229</FONT><A NAME="1229"></A></FONT>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] =  dd;
<FONT ID="LN">1230</FONT><A NAME="1230"></A>      }
<FONT ID="LN">1231</FONT><A NAME="1231"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1232</FONT><A NAME="1232"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.BYTE:
<FONT ID="LN">1233</FONT><A NAME="1233"></A>      <FONT ID="Byte">byte</FONT> by = rs.getByte(i);
<FONT ID="LN">1234</FONT><A NAME="1234"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1235</FONT><A NAME="1235"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1236</FONT><A NAME="1236"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1237</FONT><A NAME="1237"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)by;
<FONT ID="LN">1238</FONT><A NAME="1238"></A>      }
<FONT ID="LN">1239</FONT><A NAME="1239"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1240</FONT><A NAME="1240"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.SHORT:
<FONT ID="LN">1241</FONT><A NAME="1241"></A>      <FONT ID="Short">short</FONT> sh = rs.getShort(i);
<FONT ID="LN">1242</FONT><A NAME="1242"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1243</FONT><A NAME="1243"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1244</FONT><A NAME="1244"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1245</FONT><A NAME="1245"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)sh;
<FONT ID="LN">1246</FONT><A NAME="1246"></A>      }
<FONT ID="LN">1247</FONT><A NAME="1247"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1248</FONT><A NAME="1248"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.INTEGER:
<FONT ID="LN">1249</FONT><A NAME="1249"></A>      <FONT ID="Int">int</FONT> in = rs.getInt(i);
<FONT ID="LN">1250</FONT><A NAME="1250"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1251</FONT><A NAME="1251"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1252</FONT><A NAME="1252"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1253</FONT><A NAME="1253"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)in;
<FONT ID="LN">1254</FONT><A NAME="1254"></A>      }
<FONT ID="LN">1255</FONT><A NAME="1255"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1256</FONT><A NAME="1256"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.LONG:
<FONT ID="LN">1257</FONT><A NAME="1257"></A>      <FONT ID="Long">long</FONT> lo = rs.getLong(i);
<FONT ID="LN">1258</FONT><A NAME="1258"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1259</FONT><A NAME="1259"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1260</FONT><A NAME="1260"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1261</FONT><A NAME="1261"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)lo;
<FONT ID="LN">1262</FONT><A NAME="1262"></A>      }
<FONT ID="LN">1263</FONT><A NAME="1263"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1264</FONT><A NAME="1264"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.FLOAT:
<FONT ID="LN">1265</FONT><A NAME="1265"></A>      <FONT ID="Float">float</FONT> fl = rs.getFloat(i);
<FONT ID="LN">1266</FONT><A NAME="1266"></A>      <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1267</FONT><A NAME="1267"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1268</FONT><A NAME="1268"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1269</FONT><A NAME="1269"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)fl;
<FONT ID="LN">1270</FONT><A NAME="1270"></A>      }
<FONT ID="LN">1271</FONT><A NAME="1271"></A>      <FONT ID="Break">break</FONT>;
<FONT ID="LN">1272</FONT><A NAME="1272"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.DATE:
<FONT ID="LN">1273</FONT><A NAME="1273"></A>          Date date = rs.getDate(i);
<FONT ID="LN">1274</FONT><A NAME="1274"></A>          <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1275</FONT><A NAME="1275"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1276</FONT><A NAME="1276"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1277</FONT><A NAME="1277"></A>            <FONT ID="SingleLineComment">// TODO: Do a value check here.
<FONT ID="LN">1278</FONT><A NAME="1278"></A></FONT>            vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>)date.getTime();
<FONT ID="LN">1279</FONT><A NAME="1279"></A>          }
<FONT ID="LN">1280</FONT><A NAME="1280"></A>          <FONT ID="Break">break</FONT>;
<FONT ID="LN">1281</FONT><A NAME="1281"></A>    <FONT ID="Case">case</FONT> DatabaseConnection.TIME:
<FONT ID="LN">1282</FONT><A NAME="1282"></A>          Time time = rs.getTime(i);
<FONT ID="LN">1283</FONT><A NAME="1283"></A>          <FONT ID="If">if</FONT> (rs.wasNull()) {
<FONT ID="LN">1284</FONT><A NAME="1284"></A>        vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1285</FONT><A NAME="1285"></A>      } <FONT ID="Else">else</FONT> {
<FONT ID="LN">1286</FONT><A NAME="1286"></A>            <FONT ID="SingleLineComment">// TODO: Do a value check here.
<FONT ID="LN">1287</FONT><A NAME="1287"></A></FONT>            vals[i - <FONT ID="IntegerLiteral">1</FONT>] = (<FONT ID="Double">double</FONT>) time.getTime();
<FONT ID="LN">1288</FONT><A NAME="1288"></A>          }
<FONT ID="LN">1289</FONT><A NAME="1289"></A>          <FONT ID="Break">break</FONT>;
<FONT ID="LN">1290</FONT><A NAME="1290"></A>    <FONT ID="Default">default</FONT>:
<FONT ID="LN">1291</FONT><A NAME="1291"></A>      vals[i - <FONT ID="IntegerLiteral">1</FONT>] = Utils.missingValue();
<FONT ID="LN">1292</FONT><A NAME="1292"></A>    }
<FONT ID="LN">1293</FONT><A NAME="1293"></A>      }
<FONT ID="LN">1294</FONT><A NAME="1294"></A>       <A HREF="../../../weka/core/Instance.java.html">Instance</A> inst = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/DenseInstance.java.html">DenseInstance</A>(<FONT ID="FloatPointLiteral">1.0</FONT>, vals);
<FONT ID="LN">1295</FONT><A NAME="1295"></A>       <FONT ID="SingleLineComment">//get rid of m_idColumn
<FONT ID="LN">1296</FONT><A NAME="1296"></A></FONT>       <FONT ID="If">if</FONT>(m_DataBaseConnection.getUpperCase())
<FONT ID="LN">1297</FONT><A NAME="1297"></A>              m_idColumn = m_idColumn.toUpperCase();
<FONT ID="LN">1298</FONT><A NAME="1298"></A>       <FONT ID="If">if</FONT>(m_structure.attribute(<FONT ID="IntegerLiteral">0</FONT>).name().equals(m_idColumn)){
<FONT ID="LN">1299</FONT><A NAME="1299"></A>            inst.deleteAttributeAt(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1300</FONT><A NAME="1300"></A>            m_oldStructure.add(inst);
<FONT ID="LN">1301</FONT><A NAME="1301"></A>            inst = m_oldStructure.instance(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1302</FONT><A NAME="1302"></A>            m_oldStructure.delete(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1303</FONT><A NAME="1303"></A>       }
<FONT ID="LN">1304</FONT><A NAME="1304"></A>       <FONT ID="Else">else</FONT>{
<FONT ID="LN">1305</FONT><A NAME="1305"></A>        <FONT ID="SingleLineComment">//instances is added to and deleted from the structure to get the true nominal values instead of the index of the values.
<FONT ID="LN">1306</FONT><A NAME="1306"></A></FONT>        m_structure.add(inst);
<FONT ID="LN">1307</FONT><A NAME="1307"></A>        inst = m_structure.instance(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1308</FONT><A NAME="1308"></A>        m_structure.delete(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1309</FONT><A NAME="1309"></A>       }
<FONT ID="LN">1310</FONT><A NAME="1310"></A>       <FONT ID="Return">return</FONT> inst;
<FONT ID="LN">1311</FONT><A NAME="1311"></A>       
<FONT ID="LN">1312</FONT><A NAME="1312"></A>  }
<FONT ID="LN">1313</FONT><A NAME="1313"></A>
<FONT ID="LN">1314</FONT><A NAME="1314"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">1315</FONT><A NAME="1315"></A>   * Read the data set incrementally---get the next instance in the data 
<FONT ID="LN">1316</FONT><A NAME="1316"></A>   * set or returns null if there are no
<FONT ID="LN">1317</FONT><A NAME="1317"></A>   * more instances to get. If the structure hasn't yet been 
<FONT ID="LN">1318</FONT><A NAME="1318"></A>   * determined by a call to getStructure then method does so before
<FONT ID="LN">1319</FONT><A NAME="1319"></A>   * returning the next instance in the data set.
<FONT ID="LN">1320</FONT><A NAME="1320"></A>   *
<FONT ID="LN">1321</FONT><A NAME="1321"></A>   * @param structure the dataset header information, will get updated in 
<FONT ID="LN">1322</FONT><A NAME="1322"></A>   * case of string or relational attributes
<FONT ID="LN">1323</FONT><A NAME="1323"></A>   * @return the next instance in the data set as an Instance object or null
<FONT ID="LN">1324</FONT><A NAME="1324"></A>   * if there are no more instances to be read
<FONT ID="LN">1325</FONT><A NAME="1325"></A>   * @throws IOException if there is an error during parsing
<FONT ID="LN">1326</FONT><A NAME="1326"></A>   */</FONT>
<FONT ID="LN">1327</FONT><A NAME="1327"></A>  <FONT ID="Public">public</FONT> <A HREF="../../../weka/core/Instance.java.html">Instance</A> getNextInstance(<A HREF="../../../weka/core/Instances.java.html">Instances</A> structure) <FONT ID="Throws">throws</FONT> IOException {
<FONT ID="LN">1328</FONT><A NAME="1328"></A>
<FONT ID="LN">1329</FONT><A NAME="1329"></A>    m_structure = structure;
<FONT ID="LN">1330</FONT><A NAME="1330"></A>      
<FONT ID="LN">1331</FONT><A NAME="1331"></A>    <FONT ID="If">if</FONT> (m_DataBaseConnection == <FONT ID="Null">null</FONT>) 
<FONT ID="LN">1332</FONT><A NAME="1332"></A>      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"No source database has been specified"</FONT>); 
<FONT ID="LN">1333</FONT><A NAME="1333"></A>    <FONT ID="If">if</FONT> (getRetrieval() == BATCH) {
<FONT ID="LN">1334</FONT><A NAME="1334"></A>      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(<FONT ID="StringLiteral">"Cannot mix getting Instances in both incremental and batch modes"</FONT>);
<FONT ID="LN">1335</FONT><A NAME="1335"></A>    }
<FONT ID="LN">1336</FONT><A NAME="1336"></A>    <FONT ID="SingleLineComment">//pseudoInremental: Load all instances into main memory in batch mode and give them incrementally to user
<FONT ID="LN">1337</FONT><A NAME="1337"></A></FONT>    <FONT ID="If">if</FONT>(m_pseudoIncremental){
<FONT ID="LN">1338</FONT><A NAME="1338"></A>        setRetrieval(INCREMENTAL);
<FONT ID="LN">1339</FONT><A NAME="1339"></A>        <FONT ID="If">if</FONT>(m_datasetPseudoInc.numInstances() &gt; <FONT ID="IntegerLiteral">0</FONT>){
<FONT ID="LN">1340</FONT><A NAME="1340"></A>            <A HREF="../../../weka/core/Instance.java.html">Instance</A> current = m_datasetPseudoInc.instance(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1341</FONT><A NAME="1341"></A>            m_datasetPseudoInc.delete(<FONT ID="IntegerLiteral">0</FONT>);
<FONT ID="LN">1342</FONT><A NAME="1342"></A>            <FONT ID="Return">return</FONT> current;
<FONT ID="LN">1343</FONT><A NAME="1343"></A>        }
<FONT ID="LN">1344</FONT><A NAME="1344"></A>        <FONT ID="Else">else</FONT>{
<FONT ID="LN">1345</FONT><A NAME="1345"></A>            resetStructure();
<FONT ID="LN">1346</FONT><A NAME="1346"></A>            <FONT ID="Return">return</FONT> <FONT ID="Null">null</FONT>;
<FONT ID="LN">1347</FONT><A NAME="1347"></A>        }
<FONT ID="LN">1348</FONT><A NAME="1348"></A>    }
<FONT ID="LN">1349</FONT><A NAME="1349"></A>    <FONT ID="SingleLineComment">//real incremental mode. At the moment(version 1.0) only for MySQL and HSQLDB (Postgres not tested, should work)
<FONT ID="LN">1350</FONT><A NAME="1350"></A></FONT>    setRetrieval(INCREMENTAL);
<FONT ID="LN">1351</FONT><A NAME="1351"></A>    <FONT ID="Try">try</FONT>{
<FONT ID="LN">1352</FONT><A NAME="1352"></A>        <FONT ID="If">if</FONT>(!m_DataBaseConnection.isConnected())
<FONT ID="LN">1353</FONT><A NAME="1353"></A>            connectToDatabase();
<FONT ID="LN">1354</FONT><A NAME="1354"></A>        <FONT ID="SingleLineComment">//if no key columns specified by user, try to detect automatically
<FONT ID="LN">1355</FONT><A NAME="1355"></A></FONT>        <FONT ID="If">if</FONT>(m_firstTime &amp;&amp; m_orderBy.size() == <FONT ID="IntegerLiteral">0</FONT>){
<FONT ID="LN">1356</FONT><A NAME="1356"></A>            <FONT ID="If">if</FONT>(!checkForKey())
<FONT ID="LN">1357</FONT><A NAME="1357"></A>                <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> Exception(<FONT ID="StringLiteral">"A unique order cannot be detected automatically.\nYou have to use SELECT * in your query to enable this feature.\nMaybe JDBC driver is not able to detect key.\nDefine primary key in your database or use -P option (command line) or enter key columns in the GUI."</FONT>);
<FONT ID="LN">1358</FONT><A NAME="1358"></A>        }
<FONT ID="LN">1359</FONT><A NAME="1359"></A>        <FONT ID="If">if</FONT>(m_firstTime){
<FONT ID="LN">1360</FONT><A NAME="1360"></A>            m_firstTime = <FONT ID="False">false</FONT>;
<FONT ID="LN">1361</FONT><A NAME="1361"></A>            m_rowCount = getRowCount();
<FONT ID="LN">1362</FONT><A NAME="1362"></A>        }
<FONT ID="LN">1363</FONT><A NAME="1363"></A>        <FONT ID="SingleLineComment">//as long as not all rows has been loaded
<FONT ID="LN">1364</FONT><A NAME="1364"></A></FONT>        <FONT ID="If">if</FONT>(m_counter &lt; m_rowCount){
<FONT ID="LN">1365</FONT><A NAME="1365"></A>            <FONT ID="If">if</FONT> (m_DataBaseConnection.execute(limitQuery(m_query,m_counter,m_choice)) == <FONT ID="False">false</FONT>) {
<FONT ID="LN">1366</FONT><A NAME="1366"></A>                <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> Exception(<FONT ID="StringLiteral">"Tuple could not be retrieved."</FONT>);
<FONT ID="LN">1367</FONT><A NAME="1367"></A>            }
<FONT ID="LN">1368</FONT><A NAME="1368"></A>            m_counter++;
<FONT ID="LN">1369</FONT><A NAME="1369"></A>            ResultSet rs = m_DataBaseConnection.getResultSet();
<FONT ID="LN">1370</FONT><A NAME="1370"></A>            rs.next();
<FONT ID="LN">1371</FONT><A NAME="1371"></A>            <A HREF="../../../weka/core/Instance.java.html">Instance</A> current = readInstance(rs);
<FONT ID="LN">1372</FONT><A NAME="1372"></A>            rs.close();
<FONT ID="LN">1373</FONT><A NAME="1373"></A>            <FONT ID="Return">return</FONT> current;
<FONT ID="LN">1374</FONT><A NAME="1374"></A>        }
<FONT ID="LN">1375</FONT><A NAME="1375"></A>        <FONT ID="Else">else</FONT>{
<FONT ID="LN">1376</FONT><A NAME="1376"></A>            m_DataBaseConnection.disconnectFromDatabase();
<FONT ID="LN">1377</FONT><A NAME="1377"></A>            resetStructure();
<FONT ID="LN">1378</FONT><A NAME="1378"></A>            <FONT ID="Return">return</FONT> <FONT ID="Null">null</FONT>;
<FONT ID="LN">1379</FONT><A NAME="1379"></A>        }
<FONT ID="LN">1380</FONT><A NAME="1380"></A>    }<FONT ID="Catch">catch</FONT>(Exception ex) {
<FONT ID="LN">1381</FONT><A NAME="1381"></A>        printException(ex);
<FONT ID="LN">1382</FONT><A NAME="1382"></A>    }
<FONT ID="LN">1383</FONT><A NAME="1383"></A>    <FONT ID="Return">return</FONT> <FONT ID="Null">null</FONT>;
<FONT ID="LN">1384</FONT><A NAME="1384"></A>  }
<FONT ID="LN">1385</FONT><A NAME="1385"></A>  
<FONT ID="LN">1386</FONT><A NAME="1386"></A>  
<FONT ID="LN">1387</FONT><A NAME="1387"></A>  
<FONT ID="LN">1388</FONT><A NAME="1388"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">1389</FONT><A NAME="1389"></A>   * Gets the setting
<FONT ID="LN">1390</FONT><A NAME="1390"></A>   * 
<FONT ID="LN">1391</FONT><A NAME="1391"></A>   * @return the current setting
<FONT ID="LN">1392</FONT><A NAME="1392"></A>   */</FONT>  
<FONT ID="LN">1393</FONT><A NAME="1393"></A>  <FONT ID="Public">public</FONT> String[] getOptions() {
<FONT ID="LN">1394</FONT><A NAME="1394"></A>      
<FONT ID="LN">1395</FONT><A NAME="1395"></A>    Vector&lt;String&gt; options = <FONT ID="New">new</FONT> Vector&lt;String&gt;();
<FONT ID="LN">1396</FONT><A NAME="1396"></A>
<FONT ID="LN">1397</FONT><A NAME="1397"></A>    <FONT ID="If">if</FONT> ( (getUrl() != <FONT ID="Null">null</FONT>) &amp;&amp; (getUrl().length() != <FONT ID="IntegerLiteral">0</FONT>) ) {
<FONT ID="LN">1398</FONT><A NAME="1398"></A>      options.add(<FONT ID="StringLiteral">"-url"</FONT>);
<FONT ID="LN">1399</FONT><A NAME="1399"></A>      options.add(getUrl());
<FONT ID="LN">1400</FONT><A NAME="1400"></A>    }
<FONT ID="LN">1401</FONT><A NAME="1401"></A>    
<FONT ID="LN">1402</FONT><A NAME="1402"></A>    <FONT ID="If">if</FONT> ( (getUser() != <FONT ID="Null">null</FONT>) &amp;&amp; (getUser().length() != <FONT ID="IntegerLiteral">0</FONT>) ) {
<FONT ID="LN">1403</FONT><A NAME="1403"></A>      options.add(<FONT ID="StringLiteral">"-user"</FONT>);
<FONT ID="LN">1404</FONT><A NAME="1404"></A>      options.add(getUser());
<FONT ID="LN">1405</FONT><A NAME="1405"></A>    }
<FONT ID="LN">1406</FONT><A NAME="1406"></A>    
<FONT ID="LN">1407</FONT><A NAME="1407"></A>    <FONT ID="If">if</FONT> ( (getPassword() != <FONT ID="Null">null</FONT>) &amp;&amp; (getPassword().length() != <FONT ID="IntegerLiteral">0</FONT>) ) {
<FONT ID="LN">1408</FONT><A NAME="1408"></A>      options.add(<FONT ID="StringLiteral">"-password"</FONT>);
<FONT ID="LN">1409</FONT><A NAME="1409"></A>      options.add(getPassword());
<FONT ID="LN">1410</FONT><A NAME="1410"></A>    }
<FONT ID="LN">1411</FONT><A NAME="1411"></A>
<FONT ID="LN">1412</FONT><A NAME="1412"></A>    options.add(<FONT ID="StringLiteral">"-Q"</FONT>); 
<FONT ID="LN">1413</FONT><A NAME="1413"></A>    options.add(getQuery());
<FONT ID="LN">1414</FONT><A NAME="1414"></A>    
<FONT ID="LN">1415</FONT><A NAME="1415"></A>    StringBuffer text = <FONT ID="New">new</FONT> StringBuffer();
<FONT ID="LN">1416</FONT><A NAME="1416"></A>    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>; i &lt; m_orderBy.size(); i++) {
<FONT ID="LN">1417</FONT><A NAME="1417"></A>      <FONT ID="If">if</FONT> (i &gt; <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">1418</FONT><A NAME="1418"></A>        text.append(<FONT ID="StringLiteral">", "</FONT>);
<FONT ID="LN">1419</FONT><A NAME="1419"></A>      text.append((String) m_orderBy.get(i));
<FONT ID="LN">1420</FONT><A NAME="1420"></A>    }
<FONT ID="LN">1421</FONT><A NAME="1421"></A>    options.add(<FONT ID="StringLiteral">"-P"</FONT>); 
<FONT ID="LN">1422</FONT><A NAME="1422"></A>    options.add(text.toString());
<FONT ID="LN">1423</FONT><A NAME="1423"></A>    
<FONT ID="LN">1424</FONT><A NAME="1424"></A>    <FONT ID="If">if</FONT> (m_inc)
<FONT ID="LN">1425</FONT><A NAME="1425"></A>      options.add(<FONT ID="StringLiteral">"-I"</FONT>);
<FONT ID="LN">1426</FONT><A NAME="1426"></A>    
<FONT ID="LN">1427</FONT><A NAME="1427"></A>    <FONT ID="Return">return</FONT> (String[]) options.toArray(<FONT ID="New">new</FONT> String[options.size()]);
<FONT ID="LN">1428</FONT><A NAME="1428"></A>  }
<FONT ID="LN">1429</FONT><A NAME="1429"></A>  
<FONT ID="LN">1430</FONT><A NAME="1430"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">1431</FONT><A NAME="1431"></A>   * Lists the available options
<FONT ID="LN">1432</FONT><A NAME="1432"></A>   * 
<FONT ID="LN">1433</FONT><A NAME="1433"></A>   * @return an enumeration of the available options
<FONT ID="LN">1434</FONT><A NAME="1434"></A>   */</FONT>  
<FONT ID="LN">1435</FONT><A NAME="1435"></A>  <FONT ID="Public">public</FONT> java.util.Enumeration listOptions() {
<FONT ID="LN">1436</FONT><A NAME="1436"></A>      
<FONT ID="LN">1437</FONT><A NAME="1437"></A>     Vector&lt;<A HREF="../../../weka/core/Option.java.html">Option</A>&gt; newVector = <FONT ID="New">new</FONT> Vector&lt;<A HREF="../../../weka/core/Option.java.html">Option</A>&gt;();
<FONT ID="LN">1438</FONT><A NAME="1438"></A>
<FONT ID="LN">1439</FONT><A NAME="1439"></A>     newVector.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Option.java.html">Option</A>(
<FONT ID="LN">1440</FONT><A NAME="1440"></A>           <FONT ID="StringLiteral">"\tThe JDBC URL to connect to.\n"</FONT>
<FONT ID="LN">1441</FONT><A NAME="1441"></A>           + <FONT ID="StringLiteral">"\t(default: from DatabaseUtils.props file)"</FONT>,
<FONT ID="LN">1442</FONT><A NAME="1442"></A>           <FONT ID="StringLiteral">"url"</FONT>, <FONT ID="IntegerLiteral">1</FONT>, <FONT ID="StringLiteral">"-url &lt;JDBC URL&gt;"</FONT>));
<FONT ID="LN">1443</FONT><A NAME="1443"></A>     
<FONT ID="LN">1444</FONT><A NAME="1444"></A>     newVector.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Option.java.html">Option</A>(
<FONT ID="LN">1445</FONT><A NAME="1445"></A>           <FONT ID="StringLiteral">"\tThe user to connect with to the database.\n"</FONT>
<FONT ID="LN">1446</FONT><A NAME="1446"></A>           + <FONT ID="StringLiteral">"\t(default: none)"</FONT>,
<FONT ID="LN">1447</FONT><A NAME="1447"></A>           <FONT ID="StringLiteral">"user"</FONT>, <FONT ID="IntegerLiteral">1</FONT>, <FONT ID="StringLiteral">"-user &lt;name&gt;"</FONT>));
<FONT ID="LN">1448</FONT><A NAME="1448"></A>     
<FONT ID="LN">1449</FONT><A NAME="1449"></A>     newVector.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Option.java.html">Option</A>(
<FONT ID="LN">1450</FONT><A NAME="1450"></A>           <FONT ID="StringLiteral">"\tThe password to connect with to the database.\n"</FONT>
<FONT ID="LN">1451</FONT><A NAME="1451"></A>           + <FONT ID="StringLiteral">"\t(default: none)"</FONT>,
<FONT ID="LN">1452</FONT><A NAME="1452"></A>           <FONT ID="StringLiteral">"password"</FONT>, <FONT ID="IntegerLiteral">1</FONT>, <FONT ID="StringLiteral">"-password &lt;password&gt;"</FONT>));
<FONT ID="LN">1453</FONT><A NAME="1453"></A>     
<FONT ID="LN">1454</FONT><A NAME="1454"></A>     newVector.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Option.java.html">Option</A>(
<FONT ID="LN">1455</FONT><A NAME="1455"></A>     <FONT ID="StringLiteral">"\tSQL query of the form\n"</FONT>
<FONT ID="LN">1456</FONT><A NAME="1456"></A>     + <FONT ID="StringLiteral">"\t\tSELECT &lt;list of columns&gt;|* FROM &lt;table&gt; [WHERE]\n"</FONT>
<FONT ID="LN">1457</FONT><A NAME="1457"></A>     + <FONT ID="StringLiteral">"\tto execute.\n"</FONT>
<FONT ID="LN">1458</FONT><A NAME="1458"></A>         + <FONT ID="StringLiteral">"\t(default: Select * From Results0)"</FONT>,
<FONT ID="LN">1459</FONT><A NAME="1459"></A>     <FONT ID="StringLiteral">"Q"</FONT>,<FONT ID="IntegerLiteral">1</FONT>,<FONT ID="StringLiteral">"-Q &lt;query&gt;"</FONT>));
<FONT ID="LN">1460</FONT><A NAME="1460"></A>     
<FONT ID="LN">1461</FONT><A NAME="1461"></A>     newVector.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Option.java.html">Option</A>(
<FONT ID="LN">1462</FONT><A NAME="1462"></A>     <FONT ID="StringLiteral">"\tList of column names uniquely defining a DB row\n"</FONT>
<FONT ID="LN">1463</FONT><A NAME="1463"></A>     + <FONT ID="StringLiteral">"\t(separated by ', ').\n"</FONT>
<FONT ID="LN">1464</FONT><A NAME="1464"></A>         + <FONT ID="StringLiteral">"\tUsed for incremental loading.\n"</FONT>
<FONT ID="LN">1465</FONT><A NAME="1465"></A>     + <FONT ID="StringLiteral">"\tIf not specified, the key will be determined automatically,\n"</FONT>
<FONT ID="LN">1466</FONT><A NAME="1466"></A>     + <FONT ID="StringLiteral">"\tif possible with the used JDBC driver.\n"</FONT>
<FONT ID="LN">1467</FONT><A NAME="1467"></A>     + <FONT ID="StringLiteral">"\tThe auto ID column created by the DatabaseSaver won't be loaded."</FONT>,
<FONT ID="LN">1468</FONT><A NAME="1468"></A>     <FONT ID="StringLiteral">"P"</FONT>,<FONT ID="IntegerLiteral">1</FONT>,<FONT ID="StringLiteral">"-P &lt;list of column names&gt;"</FONT>));
<FONT ID="LN">1469</FONT><A NAME="1469"></A>
<FONT ID="LN">1470</FONT><A NAME="1470"></A>     newVector.add(<FONT ID="New">new</FONT> <A HREF="../../../weka/core/Option.java.html">Option</A>(
<FONT ID="LN">1471</FONT><A NAME="1471"></A>     <FONT ID="StringLiteral">"\tSets incremental loading"</FONT>, 
<FONT ID="LN">1472</FONT><A NAME="1472"></A>     <FONT ID="StringLiteral">"I"</FONT>, <FONT ID="IntegerLiteral">0</FONT>, <FONT ID="StringLiteral">"-I"</FONT>));
<FONT ID="LN">1473</FONT><A NAME="1473"></A>     
<FONT ID="LN">1474</FONT><A NAME="1474"></A>     <FONT ID="Return">return</FONT>  newVector.elements();
<FONT ID="LN">1475</FONT><A NAME="1475"></A>  }
<FONT ID="LN">1476</FONT><A NAME="1476"></A>  
<FONT ID="LN">1477</FONT><A NAME="1477"></A>  <FONT ID="FormalComment">/** 
<FONT ID="LN">1478</FONT><A NAME="1478"></A>   * Sets the options.
<FONT ID="LN">1479</FONT><A NAME="1479"></A>   *
<FONT ID="LN">1480</FONT><A NAME="1480"></A>   &lt;!-- options-start --&gt;
<FONT ID="LN">1481</FONT><A NAME="1481"></A>   * Valid options are: &lt;p/&gt;
<FONT ID="LN">1482</FONT><A NAME="1482"></A>   * 
<FONT ID="LN">1483</FONT><A NAME="1483"></A>   * &lt;pre&gt; -url &amp;lt;JDBC URL&amp;gt;
<FONT ID="LN">1484</FONT><A NAME="1484"></A>   *  The JDBC URL to connect to.
<FONT ID="LN">1485</FONT><A NAME="1485"></A>   *  (default: from DatabaseUtils.props file)&lt;/pre&gt;
<FONT ID="LN">1486</FONT><A NAME="1486"></A>   * 
<FONT ID="LN">1487</FONT><A NAME="1487"></A>   * &lt;pre&gt; -user &amp;lt;name&amp;gt;
<FONT ID="LN">1488</FONT><A NAME="1488"></A>   *  The user to connect with to the database.
<FONT ID="LN">1489</FONT><A NAME="1489"></A>   *  (default: none)&lt;/pre&gt;
<FONT ID="LN">1490</FONT><A NAME="1490"></A>   * 
<FONT ID="LN">1491</FONT><A NAME="1491"></A>   * &lt;pre&gt; -password &amp;lt;password&amp;gt;
<FONT ID="LN">1492</FONT><A NAME="1492"></A>   *  The password to connect with to the database.
<FONT ID="LN">1493</FONT><A NAME="1493"></A>   *  (default: none)&lt;/pre&gt;
<FONT ID="LN">1494</FONT><A NAME="1494"></A>   * 
<FONT ID="LN">1495</FONT><A NAME="1495"></A>   * &lt;pre&gt; -Q &amp;lt;query&amp;gt;
<FONT ID="LN">1496</FONT><A NAME="1496"></A>   *  SQL query of the form
<FONT ID="LN">1497</FONT><A NAME="1497"></A>   *   SELECT &amp;lt;list of columns&amp;gt;|* FROM &amp;lt;table&amp;gt; [WHERE]
<FONT ID="LN">1498</FONT><A NAME="1498"></A>   *  to execute.
<FONT ID="LN">1499</FONT><A NAME="1499"></A>   *  (default: Select * From Results0)&lt;/pre&gt;
<FONT ID="LN">1500</FONT><A NAME="1500"></A>   * 
<FONT ID="LN">1501</FONT><A NAME="1501"></A>   * &lt;pre&gt; -P &amp;lt;list of column names&amp;gt;
<FONT ID="LN">1502</FONT><A NAME="1502"></A>   *  List of column names uniquely defining a DB row
<FONT ID="LN">1503</FONT><A NAME="1503"></A>   *  (separated by ', ').
<FONT ID="LN">1504</FONT><A NAME="1504"></A>   *  Used for incremental loading.
<FONT ID="LN">1505</FONT><A NAME="1505"></A>   *  If not specified, the key will be determined automatically,
<FONT ID="LN">1506</FONT><A NAME="1506"></A>   *  if possible with the used JDBC driver.
<FONT ID="LN">1507</FONT><A NAME="1507"></A>   *  The auto ID column created by the DatabaseSaver won't be loaded.&lt;/pre&gt;
<FONT ID="LN">1508</FONT><A NAME="1508"></A>   * 
<FONT ID="LN">1509</FONT><A NAME="1509"></A>   * &lt;pre&gt; -I
<FONT ID="LN">1510</FONT><A NAME="1510"></A>   *  Sets incremental loading&lt;/pre&gt;
<FONT ID="LN">1511</FONT><A NAME="1511"></A>   * 
<FONT ID="LN">1512</FONT><A NAME="1512"></A>   &lt;!-- options-end --&gt;
<FONT ID="LN">1513</FONT><A NAME="1513"></A>   *
<FONT ID="LN">1514</FONT><A NAME="1514"></A>   * @param options the options
<FONT ID="LN">1515</FONT><A NAME="1515"></A>   * @throws Exception if options cannot be set
<FONT ID="LN">1516</FONT><A NAME="1516"></A>   */</FONT>  
<FONT ID="LN">1517</FONT><A NAME="1517"></A>  <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setOptions(String[] options) <FONT ID="Throws">throws</FONT> Exception {
<FONT ID="LN">1518</FONT><A NAME="1518"></A>      
<FONT ID="LN">1519</FONT><A NAME="1519"></A>    String optionString, keyString, tmpStr;
<FONT ID="LN">1520</FONT><A NAME="1520"></A>    
<FONT ID="LN">1521</FONT><A NAME="1521"></A>    optionString = Utils.getOption(<FONT ID="CharacerLiteral">'Q'</FONT>, options);
<FONT ID="LN">1522</FONT><A NAME="1522"></A>    
<FONT ID="LN">1523</FONT><A NAME="1523"></A>    keyString = Utils.getOption(<FONT ID="CharacerLiteral">'P'</FONT>, options);
<FONT ID="LN">1524</FONT><A NAME="1524"></A>    
<FONT ID="LN">1525</FONT><A NAME="1525"></A>    reset();
<FONT ID="LN">1526</FONT><A NAME="1526"></A>    
<FONT ID="LN">1527</FONT><A NAME="1527"></A>    tmpStr = Utils.getOption(<FONT ID="StringLiteral">"url"</FONT>, options);
<FONT ID="LN">1528</FONT><A NAME="1528"></A>    <FONT ID="If">if</FONT> (tmpStr.length() != <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">1529</FONT><A NAME="1529"></A>      setUrl(tmpStr);
<FONT ID="LN">1530</FONT><A NAME="1530"></A>
<FONT ID="LN">1531</FONT><A NAME="1531"></A>    tmpStr = Utils.getOption(<FONT ID="StringLiteral">"user"</FONT>, options);
<FONT ID="LN">1532</FONT><A NAME="1532"></A>    <FONT ID="If">if</FONT> (tmpStr.length() != <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">1533</FONT><A NAME="1533"></A>      setUser(tmpStr);
<FONT ID="LN">1534</FONT><A NAME="1534"></A>    
<FONT ID="LN">1535</FONT><A NAME="1535"></A>    tmpStr = Utils.getOption(<FONT ID="StringLiteral">"password"</FONT>, options);
<FONT ID="LN">1536</FONT><A NAME="1536"></A>    <FONT ID="If">if</FONT> (tmpStr.length() != <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">1537</FONT><A NAME="1537"></A>      setPassword(tmpStr);
<FONT ID="LN">1538</FONT><A NAME="1538"></A>    
<FONT ID="LN">1539</FONT><A NAME="1539"></A>    <FONT ID="If">if</FONT> (optionString.length() != <FONT ID="IntegerLiteral">0</FONT>)
<FONT ID="LN">1540</FONT><A NAME="1540"></A>      setQuery(optionString);
<FONT ID="LN">1541</FONT><A NAME="1541"></A>    
<FONT ID="LN">1542</FONT><A NAME="1542"></A>    m_orderBy.clear();
<FONT ID="LN">1543</FONT><A NAME="1543"></A>    
<FONT ID="LN">1544</FONT><A NAME="1544"></A>    m_inc = Utils.getFlag(<FONT ID="CharacerLiteral">'I'</FONT>, options);
<FONT ID="LN">1545</FONT><A NAME="1545"></A>    
<FONT ID="LN">1546</FONT><A NAME="1546"></A>    <FONT ID="If">if</FONT>(m_inc){
<FONT ID="LN">1547</FONT><A NAME="1547"></A>        StringTokenizer st = <FONT ID="New">new</FONT> StringTokenizer(keyString, <FONT ID="StringLiteral">","</FONT>);
<FONT ID="LN">1548</FONT><A NAME="1548"></A>        <FONT ID="While">while</FONT> (st.hasMoreTokens()) {
<FONT ID="LN">1549</FONT><A NAME="1549"></A>            String column = st.nextToken();
<FONT ID="LN">1550</FONT><A NAME="1550"></A>            column = column.replaceAll(<FONT ID="StringLiteral">" "</FONT>,<FONT ID="StringLiteral">""</FONT>);
<FONT ID="LN">1551</FONT><A NAME="1551"></A>            m_orderBy.add(column);
<FONT ID="LN">1552</FONT><A NAME="1552"></A>        }
<FONT ID="LN">1553</FONT><A NAME="1553"></A>    }
<FONT ID="LN">1554</FONT><A NAME="1554"></A>  }
<FONT ID="LN">1555</FONT><A NAME="1555"></A>  
<FONT ID="LN">1556</FONT><A NAME="1556"></A>  <FONT ID="FormalComment">/**Prints an exception
<FONT ID="LN">1557</FONT><A NAME="1557"></A>   * @param ex the exception to print
<FONT ID="LN">1558</FONT><A NAME="1558"></A>   */</FONT>  
<FONT ID="LN">1559</FONT><A NAME="1559"></A>  <FONT ID="Private">private</FONT> <FONT ID="Void">void</FONT> printException(Exception ex){
<FONT ID="LN">1560</FONT><A NAME="1560"></A>  
<FONT ID="LN">1561</FONT><A NAME="1561"></A>      System.out.println(<FONT ID="StringLiteral">"\n--- Exception caught ---\n"</FONT>);
<FONT ID="LN">1562</FONT><A NAME="1562"></A>    <FONT ID="While">while</FONT> (ex != <FONT ID="Null">null</FONT>) {
<FONT ID="LN">1563</FONT><A NAME="1563"></A>        System.out.println(<FONT ID="StringLiteral">"Message:   "</FONT>
<FONT ID="LN">1564</FONT><A NAME="1564"></A>                                   + ex.getMessage ());
<FONT ID="LN">1565</FONT><A NAME="1565"></A>                <FONT ID="If">if</FONT>(ex <FONT ID="InstanceOf">instanceof</FONT> SQLException){
<FONT ID="LN">1566</FONT><A NAME="1566"></A>                    System.out.println(<FONT ID="StringLiteral">"SQLState:  "</FONT>
<FONT ID="LN">1567</FONT><A NAME="1567"></A>                                   + ((SQLException)ex).getSQLState ());
<FONT ID="LN">1568</FONT><A NAME="1568"></A>                    System.out.println(<FONT ID="StringLiteral">"ErrorCode: "</FONT>
<FONT ID="LN">1569</FONT><A NAME="1569"></A>                                   + ((SQLException)ex).getErrorCode ());
<FONT ID="LN">1570</FONT><A NAME="1570"></A>                    ex = ((SQLException)ex).getNextException();
<FONT ID="LN">1571</FONT><A NAME="1571"></A>                }
<FONT ID="LN">1572</FONT><A NAME="1572"></A>                <FONT ID="Else">else</FONT>
<FONT ID="LN">1573</FONT><A NAME="1573"></A>                    ex = <FONT ID="Null">null</FONT>;
<FONT ID="LN">1574</FONT><A NAME="1574"></A>        System.out.println(<FONT ID="StringLiteral">""</FONT>);
<FONT ID="LN">1575</FONT><A NAME="1575"></A>    }
<FONT ID="LN">1576</FONT><A NAME="1576"></A>      
<FONT ID="LN">1577</FONT><A NAME="1577"></A>      
<FONT ID="LN">1578</FONT><A NAME="1578"></A>  }
<FONT ID="LN">1579</FONT><A NAME="1579"></A>  
<FONT ID="LN">1580</FONT><A NAME="1580"></A>  <FONT ID="FormalComment">/**
<FONT ID="LN">1581</FONT><A NAME="1581"></A>   * Returns the revision string.
<FONT ID="LN">1582</FONT><A NAME="1582"></A>   * 
<FONT ID="LN">1583</FONT><A NAME="1583"></A>   * @return        the revision
<FONT ID="LN">1584</FONT><A NAME="1584"></A>   */</FONT>
<FONT ID="LN">1585</FONT><A NAME="1585"></A>  <FONT ID="Public">public</FONT> String getRevision() {
<FONT ID="LN">1586</FONT><A NAME="1586"></A>    <FONT ID="Return">return</FONT> RevisionUtils.extract(<FONT ID="StringLiteral">"$Revision: 5987 $"</FONT>);
<FONT ID="LN">1587</FONT><A NAME="1587"></A>  }
<FONT ID="LN">1588</FONT><A NAME="1588"></A>
<FONT ID="LN">1589</FONT><A NAME="1589"></A>  <FONT ID="FormalComment">/** Main method.
<FONT ID="LN">1590</FONT><A NAME="1590"></A>   * @param options the options
<FONT ID="LN">1591</FONT><A NAME="1591"></A>   */</FONT>
<FONT ID="LN">1592</FONT><A NAME="1592"></A>  <FONT ID="Public">public</FONT> <FONT ID="Static">static</FONT> <FONT ID="Void">void</FONT> main(String [] options) {
<FONT ID="LN">1593</FONT><A NAME="1593"></A>    
<FONT ID="LN">1594</FONT><A NAME="1594"></A>      <A HREF="../../../weka/core/converters/DatabaseLoader.java.html">DatabaseLoader</A> atf;
<FONT ID="LN">1595</FONT><A NAME="1595"></A>      <FONT ID="Try">try</FONT> {
<FONT ID="LN">1596</FONT><A NAME="1596"></A>    atf = <FONT ID="New">new</FONT> <A HREF="../../../weka/core/converters/DatabaseLoader.java.html">DatabaseLoader</A>();
<FONT ID="LN">1597</FONT><A NAME="1597"></A>        atf.setOptions(options);
<FONT ID="LN">1598</FONT><A NAME="1598"></A>        atf.setSource(atf.getUrl(), atf.getUser(), atf.getPassword());
<FONT ID="LN">1599</FONT><A NAME="1599"></A>        <FONT ID="If">if</FONT>(!atf.m_inc)
<FONT ID="LN">1600</FONT><A NAME="1600"></A>            System.out.println(atf.getDataSet());
<FONT ID="LN">1601</FONT><A NAME="1601"></A>        <FONT ID="Else">else</FONT>{
<FONT ID="LN">1602</FONT><A NAME="1602"></A>            <A HREF="../../../weka/core/Instances.java.html">Instances</A> structure = atf.getStructure();
<FONT ID="LN">1603</FONT><A NAME="1603"></A>            System.out.println(structure);
<FONT ID="LN">1604</FONT><A NAME="1604"></A>            <A HREF="../../../weka/core/Instance.java.html">Instance</A> temp;
<FONT ID="LN">1605</FONT><A NAME="1605"></A>            <FONT ID="Do">do</FONT> {
<FONT ID="LN">1606</FONT><A NAME="1606"></A>            temp = atf.getNextInstance(structure);
<FONT ID="LN">1607</FONT><A NAME="1607"></A>            <FONT ID="If">if</FONT> (temp != <FONT ID="Null">null</FONT>) {
<FONT ID="LN">1608</FONT><A NAME="1608"></A>                System.out.println(temp);
<FONT ID="LN">1609</FONT><A NAME="1609"></A>            }
<FONT ID="LN">1610</FONT><A NAME="1610"></A>            } <FONT ID="While">while</FONT> (temp != <FONT ID="Null">null</FONT>);
<FONT ID="LN">1611</FONT><A NAME="1611"></A>        }
<FONT ID="LN">1612</FONT><A NAME="1612"></A>      } <FONT ID="Catch">catch</FONT> (Exception e) {
<FONT ID="LN">1613</FONT><A NAME="1613"></A>    e.printStackTrace();
<FONT ID="LN">1614</FONT><A NAME="1614"></A>        System.out.println(<FONT ID="StringLiteral">"\n"</FONT>+e.getMessage());
<FONT ID="LN">1615</FONT><A NAME="1615"></A>      }
<FONT ID="LN">1616</FONT><A NAME="1616"></A>  }
<FONT ID="LN">1617</FONT><A NAME="1617"></A>}
<FONT ID="LN">1618</FONT><A NAME="1618"></A></pre><TABLE id="Header" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2" width="33%">&nbsp;</td>
<td align="center" colspan="2" width="33%">
<font size="4">DatabaseLoader.java</font>
</td>
<td align="right" colspan="2" width="33%">&nbsp;</td>
</tr>
</TABLE>

</BODY>
</HTML>